"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{5569:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var a=r(5155),o=r(2115),l=r(3264),n=r(7431),i=r(5198),s=r(4355),c=r(133),d=r(8021),u=r(9881),m=r(8832),h=r(5169),g=r(2138),b=r(9477);let p=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),r=(0,o.useRef)(null),p=(0,o.useRef)(null),w=(0,o.useRef)(null),[f,x]=(0,o.useState)(!1),[y,v]=(0,o.useState)(!1),[k,j]=(0,o.useState)(!1),[S,N]=(0,o.useState)(!1),[E,R]=(0,o.useState)(null),[M,A]=(0,o.useState)(0),[D,C]=(0,o.useState)("environment"),[Y,F]=(0,o.useState)({x:0,y:0}),[z,B]=(0,o.useState)(0),[L,P]=(0,o.useState)(0),[X,T]=(0,o.useState)(.83),[q,I]=(0,o.useState)(0),[U,G]=(0,o.useState)(0),[W,O]=(0,o.useState)(.56),_=()=>"coicoi"===H?{rotationY:z,rotationX:L,scale:X,setRotationY:B,setRotationX:P,setScale:T}:{rotationY:q,rotationX:U,scale:W,setRotationY:I,setRotationX:G,setScale:O},[H,J]=(0,o.useState)("coicoi"),Q=(0,o.useRef)(null),Z=(0,o.useRef)(null),$=(0,o.useRef)(null),K=(0,o.useRef)(null),V=(0,o.useRef)(new l.tBo),ee=(0,o.useRef)(new l.I9Y),et=(e,t)=>{if(!p.current||!r.current)return null;let a=r.current.domElement.getBoundingClientRect();ee.current.x=(e-a.left)/a.width*2-1,ee.current.y=-(2*((t-a.top)/a.height))+1,V.current.setFromCamera(ee.current,p.current);let o=[];for(let{model:e,type:t}of(Q.current&&o.push({model:Q.current,type:"coicoi"}),Z.current&&o.push({model:Z.current,type:"wkwk"}),o))if(V.current.intersectObject(e,!0).length>0)return console.log("Selected ".concat(t," model")),t;return null},er=(0,b.useGesture)({onDrag:e=>{let{offset:[t,r]}=e;F({x:t,y:r})}}),ea=(0,b.useGesture)({onDrag:e=>{let{xy:[t,a],first:o,active:l,memo:n}=e;if(l&&k){if(o){console.log("Drag started");let e=et(t,a);e&&e!==H&&(console.log("Switching to ".concat(e," model")),J(e));let r=e||H;return{dragModel:"coicoi"===r?Q.current:Z.current,dragModelType:r}}return(null==n?void 0:n.dragModel)&&((e,t,a)=>{if(!e||!p.current||!r.current)return;let o=r.current.domElement.getBoundingClientRect();ee.current.x=(t-o.left)/o.width*2-1,ee.current.y=-(2*((a-o.top)/o.height))+1,V.current.setFromCamera(ee.current,p.current);let l=V.current.ray.direction,n=V.current.ray.origin,i=(0-n.y)/l.y;if(i>0){let t=n.clone().add(l.clone().multiplyScalar(i));e.position.x=t.x,e.position.z=t.z,e.floatData&&(e.floatData.baseY=.1)}})(n.dragModel,t,a),n}},onPinch:e=>{let{da:[,t],first:r,memo:a}=e;if(!k)return;let o=_(),l="coicoi"===H?Q.current:Z.current;if(!l)return;if(r)return console.log("2-finger rotation started"),{initialRotation:o.rotationY,initialAngle:t};let n=(t-((null==a?void 0:a.initialAngle)||0))*Math.PI/180,i=((null==a?void 0:a.initialRotation)||o.rotationY)+n;return o.setRotationY(i),l.rotation.y=i,console.log("Rotation:",Math.round(180*i/Math.PI),"\xb0"),a},onWheel:e=>{let{delta:[,t],shiftKey:r,altKey:a}=e;if(!k)return;let o=_(),l="coicoi"===H?Q.current:Z.current;if(l)if(r){let e=o.rotationY+.01*t;o.setRotationY(e),l.rotation.y=e,console.log("Shift+Scroll Rotation Y:",Math.round(180*e/Math.PI),"\xb0")}else if(a){let e=o.rotationX+.01*t;o.setRotationX(e),l.rotation.x=e,console.log("Alt+Scroll Rotation X:",Math.round(180*e/Math.PI),"\xb0")}else{let e=Math.max("wkwk"===H?.1:.5,Math.min(10,o.scale*(1-.001*t)));o.setScale(e),l.scale.setScalar(e)}}},{pinch:{scaleBounds:{min:.1,max:5},rubberband:!0}});(0,o.useEffect)(()=>{f&&(async()=>{try{let a=window.innerWidth,o=window.innerHeight,s=new l.Z58;s.background=new l.Q1f(0),t.current=s;let c=a/o,d=new l.qUd(-(10*c/2),10*c/2,5,-5,-100,100);d.position.set(0,2,5),d.lookAt(0,0,0),p.current=d;let u=new n.JeP({alpha:!0,antialias:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0});u.setSize(a,o),u.setPixelRatio(window.devicePixelRatio),u.outputColorSpace=l.er$,r.current=u,e.current&&e.current.appendChild(u.domElement);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:D,width:{ideal:1920},height:{ideal:1080}},audio:!1}),t=document.createElement("video");t.srcObject=e,t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),t.style.display="none",document.body.appendChild(t),await t.play();let r=()=>{let e=new l.Nv2(t);e.minFilter=l.k6q,e.magFilter=l.k6q,e.needsUpdate=!0,s.background=e,console.log("Camera background set successfully")};t.readyState>=2?r():t.addEventListener("loadedmetadata",r),u.videoElement=t,u.videoStream=e}catch(e){console.warn("Camera access failed:",e),s.background=new l.Q1f(4210752)}let m=new l.YJl;K.current=m,s.add(m);let h=new l.$p8(0xffffff,.9);s.add(h);let g=new l.ZyN(0xffffff,1.8);g.position.set(5,10,5),g.castShadow=!0,g.shadow.camera.near=.1,g.shadow.camera.far=50,g.shadow.camera.left=-10,g.shadow.camera.right=10,g.shadow.camera.top=10,g.shadow.camera.bottom=-10,g.shadow.mapSize.width=2048,g.shadow.mapSize.height=2048,s.add(g);let b=new l.dth(8900331,9139029,.8);b.position.set(0,10,0),s.add(b),u.shadowMap.enabled=!0,u.shadowMap.type=l.Wk7,N(!0),console.log("Basic AR initialized successfully"),(()=>{let e=new i.B;e.load("/coicoi.glb",e=>{let t=e.scene.clone();t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.scale.setScalar(X),t.position.set(-2,0,0),t.rotation.y=z,t.rotation.x=L,t.floatData={baseY:0,amplitude:.3,speed:.02,time:0},t.modelType="coicoi",Q.current=t,m.add(t),console.log("coicoi model loaded")},void 0,e=>{console.error("Error loading coicoi GLB model:",e)}),e.load("/wkwk.glb",e=>{let t=e.scene.clone();t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.scale.setScalar(W),t.position.set(2,0,0),t.rotation.y=q,t.rotation.x=U,t.floatData={baseY:0,amplitude:.3,speed:.02,time:Math.PI},t.modelType="wkwk",Z.current=t,m.add(t),j(!0),console.log("wkwk model loaded")},void 0,e=>{console.error("Error loading wkwk GLB model:",e)})})(),$.current="coicoi"===H?Q.current:Z.current;let f=a=>{let o,l;a.preventDefault();let n=Date.now();if(a instanceof MouseEvent)o=a.clientX,l=a.clientY;else{let e=a.changedTouches[0];o=e.clientX,l=e.clientY}if(n-M<300)console.log("Double tap detected - returning to initial screen"),x(!1),j(!1),N(!1),R(null),A(0),w.current&&(cancelAnimationFrame(w.current),w.current=null),e.current&&u.domElement&&e.current.removeChild(u.domElement),u.dispose(),t.current=null,p.current=null,r.current=null,$.current=null,K.current=null;else{let e=et(o,l);e&&e!==H&&(console.log("Selecting ".concat(e," model")),J(e)),A(n)}};u.domElement.addEventListener("click",f),u.domElement.addEventListener("touchend",f);let y=()=>{if(w.current=requestAnimationFrame(y),Q.current&&Q.current.floatData){let e=Q.current.floatData;e.time+=e.speed,Q.current.position.y=e.baseY+Math.sin(e.time)*e.amplitude}if(Z.current&&Z.current.floatData){let e=Z.current.floatData;e.time+=e.speed,Z.current.position.y=e.baseY+Math.sin(e.time)*e.amplitude}$.current="coicoi"===H?Q.current:Z.current,u.render(s,d)};y();let v=()=>{let e=window.innerWidth,t=window.innerHeight,r=e/t;d.left=-(10*r/2),d.right=10*r/2,d.top=5,d.bottom=-5,d.updateProjectionMatrix(),u.setSize(e,t)};return window.addEventListener("resize",v),()=>{if(window.removeEventListener("resize",v),u.domElement.removeEventListener("click",f),u.domElement.removeEventListener("touchend",f),w.current&&(cancelAnimationFrame(w.current),w.current=null),u.videoElement){let e=u.videoElement;e.pause(),e.srcObject=null,e.load(),e.parentNode&&e.parentNode.removeChild(e),u.videoElement=null}u.videoStream&&(u.videoStream.getTracks().forEach(e=>{e.stop(),e.enabled=!1}),u.videoStream=null),s&&(s.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),s.clear()),e.current&&u.domElement&&e.current.removeChild(u.domElement),u.dispose(),t.current=null,p.current=null,r.current=null,K.current=null,Q.current=null,Z.current=null,$.current=null}}catch(e){console.error("Failed to initialize basic AR:",e),R("初期化エラー: "+e.message),N(!0)}})()},[f]);let eo=async()=>{let e="environment"===D?"user":"environment";try{r.current&&r.current.videoStream&&r.current.videoStream.getTracks().forEach(e=>e.stop());let a=await navigator.mediaDevices.getUserMedia({video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}},audio:!1});if(r.current&&r.current.videoElement&&t.current){let e=r.current.videoElement;e.srcObject=a,await e.play();let o=new l.Nv2(e);o.minFilter=l.k6q,o.magFilter=l.k6q,o.needsUpdate=!0,t.current.background=o,r.current.videoStream=a}C(e),console.log("Successfully switched to ".concat(e," camera"))}catch(e){console.error("Failed to switch camera:",e)}};return(0,a.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black touch-none",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{ref:e,...ea(),className:"absolute top-0 left-0 w-full h-full touch-none",style:{touchAction:"none"}}),!S&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,a.jsx)("div",{className:"text-sm text-center",children:"ARカメラを初期化中..."})}),S&&E&&(0,a.jsxs)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-600 bg-opacity-80 text-white px-4 py-2 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-center",children:E}),(0,a.jsx)("div",{className:"text-xs text-center mt-1",children:"基本モードで続行"})]}),S&&(0,a.jsx)("button",{type:"button",onClick:eo,className:"absolute top-4 right-4 w-12 h-12 sm:w-14 sm:h-14 backdrop-blur-xl rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 shadow-2xl transition-all hover:scale-105 active:scale-95",title:"カメラ切り替え (現在: ".concat("environment"===D?"アウトカメラ":"インカメラ",")"),style:{background:"linear-gradient(135deg, rgba(56, 189, 248, 0.4), rgba(14, 165, 233, 0.2))",boxShadow:"0 8px 32px rgba(56, 189, 248, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:(0,a.jsx)(c.A,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),S&&(0,a.jsx)("div",{className:"absolute top-20 right-4 w-10 h-10 sm:w-12 sm:h-12 backdrop-blur-xl rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 shadow-2xl pointer-events-none",title:"現在選択中: ".concat("coicoi"===H?"coicoi":"wkwk","モデル"),style:{background:"coicoi"===H?"linear-gradient(135deg, rgba(239, 68, 68, 0.4), rgba(220, 38, 38, 0.2))":"linear-gradient(135deg, rgba(251, 191, 36, 0.4), rgba(245, 158, 11, 0.2))",boxShadow:"coicoi"===H?"0 8px 32px rgba(239, 68, 68, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)":"0 8px 32px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:(0,a.jsx)("div",{className:"text-white text-xs font-bold",children:"coicoi"===H?"C":"W"})}),k&&(0,a.jsxs)("div",{className:"absolute backdrop-blur-xl bg-black bg-opacity-20 rounded-3xl border border-gray-400 border-opacity-30 shadow-2xl",style:{bottom:"12%",left:"60%",transform:"translate(".concat(Y.x,"px, ").concat(Y.y,"px)"),cursor:"move",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1))",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[(0,a.jsx)("div",{...er(),className:"flex items-center justify-center p-3 border-b border-gray-500 border-opacity-20 cursor-grab active:cursor-grabbing",title:"ドラッグして移動",children:(0,a.jsx)(d.A,{className:"w-4 h-4 text-gray-300 text-opacity-80"})}),(0,a.jsxs)("div",{className:"p-3 sm:p-4 md:p-5 lg:p-6 flex flex-col space-y-3 sm:space-y-4 md:space-y-5",children:[(0,a.jsx)("div",{className:"w-20 h-20 sm:w-28 sm:h-28 md:w-32 md:h-32 lg:w-36 lg:h-36 backdrop-blur-lg bg-gray-900 bg-opacity-8 rounded-full flex items-center justify-center border border-gray-400 border-opacity-12 shadow-inner",children:(0,a.jsxs)("div",{className:"relative w-16 h-16 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32",children:[(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5 rounded-full transform -translate-x-1/2 -translate-y-1/2 shadow-sm",style:{background:"radial-gradient(circle, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1))",backdropFilter:"blur(2px)",boxShadow:"0 0 8px rgba(255, 255, 255, 0.2), inset 0 0 4px rgba(255, 255, 255, 0.1)"}}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e="coicoi"===H?Q.current:Z.current;e&&k&&(e.position.y+=.2,e.floatData&&(e.floatData.baseY+=.2))},className:"absolute top-0 left-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-blue-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"上に移動",children:(0,a.jsx)(u.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e="coicoi"===H?Q.current:Z.current;e&&k&&(e.position.y-=.2,e.floatData&&(e.floatData.baseY-=.2))},className:"absolute bottom-0 left-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-red-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"下に移動",children:(0,a.jsx)(m.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e="coicoi"===H?Q.current:Z.current;e&&k&&(e.position.x-=.3)},className:"absolute left-0 top-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-green-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"左に移動",children:(0,a.jsx)(h.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e="coicoi"===H?Q.current:Z.current;e&&k&&(e.position.x+=.3)},className:"absolute right-0 top-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-purple-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"右に移動",children:(0,a.jsx)(g.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})})]})}),(0,a.jsx)("div",{className:"w-20 h-7 sm:w-28 sm:h-9 md:w-32 md:h-10 lg:w-36 lg:h-11 backdrop-blur-lg bg-gray-800 bg-opacity-15 rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 px-3 sm:px-4 shadow-inner",children:(0,a.jsx)("input",{type:"range",min:"wkwk"===H?.1:.5,max:10,step:.1,value:_().scale,onChange:e=>{let t=parseFloat(e.target.value);_().setScale(t);let r="coicoi"===H?Q.current:Z.current;r&&r.scale.setScalar(t)},className:"w-full h-1 sm:h-1.5 md:h-2 rounded appearance-none cursor-pointer slider-thumb",title:"サイズ調整",style:{background:"linear-gradient(to right, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05))",backdropFilter:"blur(4px)"}})})]})]}),(0,a.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"10%"},children:(0,a.jsx)("button",{type:"button",onClick:()=>{if(!r.current)return;v(!0),setTimeout(()=>v(!1),150);let e=r.current.domElement.toDataURL("image/png"),t=document.createElement("a");t.download="ar-photo-".concat(Date.now(),".png"),t.href=e,t.click()},className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-36 xl:h-36 backdrop-blur-xl rounded-full flex items-center justify-center border-2 border-white border-opacity-20 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(34, 197, 94, 0.8))",boxShadow:"0 8px 32px rgba(59, 130, 246, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.1)"},children:(0,a.jsx)(s.A,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 xl:w-18 xl:h-18 text-white drop-shadow-lg"})})}),y&&(0,a.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,a.jsxs)("div",{onClick:()=>{x(!0)},className:"relative flex items-center justify-center h-full cursor-pointer overflow-hidden",style:{background:"linear-gradient(135deg, #0891b2 0%, #065f46 25%, #0d9488 50%, #0891b2 75%, #065f46 100%)",backgroundSize:"400% 400%",animation:"waveGradient 15s ease infinite"},children:[(0,a.jsxs)("div",{className:"absolute inset-0",children:[(0,a.jsx)("div",{className:"absolute w-[200%] h-[200%] -top-1/2 -left-1/2 opacity-30",style:{background:"radial-gradient(circle at 30% 50%, rgba(34, 211, 238, 0.4) 0%, transparent 50%)",animation:"rotate 20s linear infinite"}}),(0,a.jsx)("div",{className:"absolute w-[200%] h-[200%] -bottom-1/2 -right-1/2 opacity-30",style:{background:"radial-gradient(circle at 70% 50%, rgba(16, 185, 129, 0.4) 0%, transparent 50%)",animation:"rotate 25s linear infinite reverse"}})]}),(0,a.jsxs)("div",{className:"text-center relative z-10",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(s.A,{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 text-white drop-shadow-2xl animate-bounce mx-auto"})}),(0,a.jsx)("p",{className:"text-white text-lg sm:text-xl font-light drop-shadow-lg mb-4",children:"タップしてカメラを起動"}),(0,a.jsx)("p",{className:"text-white text-sm opacity-75 drop-shadow-lg",children:"モデルをタッチして選択・操作"})]})]})})}}}]);