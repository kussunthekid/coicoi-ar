"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[134],{6134:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var a=r(5155),n=r(2115);let i=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,n.createElement)("svg",{ref:t,...l,width:a,height:a,stroke:r,strokeWidth:o?24*Number(i)/Number(a):i,className:s("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...u.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),c=((e,t)=>{let r=(0,n.forwardRef)((r,a)=>{let{className:l,...c}=r;return(0,n.createElement)(o,{ref:a,iconNode:t,className:s("lucide-".concat(i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...c})});return r.displayName=i(e),r})("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),d=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),[s,l]=(0,n.useState)(2.4),[o,d]=(0,n.useState)(0),[u,h]=(0,n.useState)(0),[m,f]=(0,n.useState)(!1),[p,w]=(0,n.useState)(!1),g=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(null),v=(0,n.useRef)(null),y=(0,n.useRef)(null);return((0,n.useEffect)(()=>{if(!r||!e.current)return;let a=async()=>{if("xr"in navigator)try{if(await navigator.xr.isSessionSupported("immersive-ar"))return void n()}catch(e){console.log("WebXR not supported, falling back to camera-based solution")}c()},n=()=>{let t=new THREE.Scene;g.current=t;let r=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);b.current=r;let a=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});a.setSize(window.innerWidth,window.innerHeight),a.xr.enabled=!0,x.current=a,e.current&&e.current.appendChild(a.domElement);let n=new THREE.AmbientLight(0xffffff,.6);t.add(n);let l=new THREE.DirectionalLight(0xffffff,.8);l.position.set(1,1,1),t.add(l),i(),a.setAnimationLoop(()=>{v.current&&(v.current.rotation.y=o,v.current.rotation.x=u,v.current.scale.setScalar(s)),a.render(t,r)})},i=async()=>{try{let e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["plane-detection"],optionalFeatures:["dom-overlay"],domOverlay:{root:document.body}});x.current.xr.setSession(e),e.addEventListener("select",l),w(!0),m(g.current)}catch(e){console.error("WebXR session failed:",e),c()}},l=e=>{if(v.current&&e.inputSource){let t=e.frame,r=e.inputSource;if(r&&t){let e=x.current.xr.getReferenceSpace(),a=t.getPose(r.targetRaySpace,e);a&&(v.current.position.copy(a.transform.position),v.current.position.y-=1)}}},c=()=>{console.log("Initializing camera-based AR with simulated plane detection");let t=new THREE.Scene;g.current=t;let r=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);r.position.z=0,b.current=r;let a=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});a.setSize(window.innerWidth,window.innerHeight),a.domElement.style.position="absolute",a.domElement.style.top="0",a.domElement.style.left="0",x.current=a,e.current&&e.current.appendChild(a.domElement),d();let n=new THREE.AmbientLight(0xffffff,.7);t.add(n);let i=new THREE.DirectionalLight(0xffffff,.8);i.position.set(0,10,5),t.add(i),setTimeout(()=>{w(!0),h()},2e3);let l=()=>{y.current=requestAnimationFrame(l),v.current&&(v.current.rotation.y=o,v.current.rotation.x=u,v.current.scale.setScalar(s),v.current.position.y=-1.5+.2*Math.sin(.001*Date.now())),a.render(t,r)};l()},d=async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.error("MediaDevices API not supported"),alert("このブラウザはカメラアクセスに対応していません。HTTPSでアクセスしてください。");return}try{let e;console.log("Requesting camera access...");try{e=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}}})}catch(t){console.warn("Environment camera failed, trying any camera:",t),e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}})}if(console.log("Camera access granted"),t.current){t.current.srcObject=e;let r=t.current.play();void 0!==r&&r.then(()=>{console.log("Video playback started")}).catch(e=>{console.error("Video play failed:",e),t.current.muted=!0,t.current.play()})}}catch(r){console.error("Camera access failed:",r);let e="カメラアクセスに失敗しました。";if(r instanceof Error)switch(r.name){case"NotAllowedError":e="カメラの許可が拒否されました。ブラウザの設定でカメラアクセスを許可してください。";break;case"NotFoundError":e="カメラデバイスが見つかりません。";break;case"NotReadableError":e="カメラが他のアプリケーションで使用中です。";break;case"OverconstrainedError":e="指定されたカメラ設定がサポートされていません。";break;case"SecurityError":e="HTTPSでアクセスしてください。カメラはセキュアな接続でのみ利用可能です。";break;default:e="カメラエラー: ".concat(r.message)}alert(e),t.current&&(t.current.style.backgroundColor="#333")}},h=()=>{m(g.current)},m=e=>{new THREE.GLTFLoader().load("/coicoi.glb",t=>{let r=t.scene;r.scale.setScalar(s),r.position.set(0,0,0),v.current=r,e.add(r),console.log("Model loaded successfully")},e=>{console.log("Loading progress:",e.loaded/e.total*100+"%")},t=>{console.error("Error loading model:",t);let r=new THREE.BoxGeometry(1,1,1),a=new THREE.MeshPhongMaterial({color:65280}),n=new THREE.Mesh(r,a);v.current=n,e.add(n)})};(async()=>{let t=e=>new Promise((t,r)=>{if(document.querySelector('script[src="'.concat(e,'"]')))return void t();let a=document.createElement("script");a.src=e,a.onload=()=>t(),a.onerror=()=>r(Error("Failed to load ".concat(e))),document.head.appendChild(a)});try{await t("https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"),await t("https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"),a()}catch(t){console.error("Failed to load Three.js:",t),(()=>{let t=new THREE.Scene;g.current=t;let r=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);r.position.z=5;let a=new THREE.WebGLRenderer({alpha:!0});a.setSize(window.innerWidth,window.innerHeight),e.current&&e.current.appendChild(a.domElement);let n=new THREE.AmbientLight(0xffffff,.6);t.add(n);let i=new THREE.DirectionalLight(0xffffff,.8);i.position.set(1,1,1),t.add(i),m(t);let l=()=>{requestAnimationFrame(l),v.current&&(v.current.rotation.y=o,v.current.rotation.x=u,v.current.scale.setScalar(s)),a.render(t,r)};l()})()}})()},[r,o,u,s]),r)?(0,a.jsxs)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:[(0,a.jsx)("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0}),(0,a.jsx)("div",{ref:e,className:"absolute inset-0"}),(0,a.jsxs)("div",{className:"absolute top-4 right-4 w-52 bg-black bg-opacity-70 text-white p-3 rounded-lg text-xs",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-3",children:"モデル制御"}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsxs)("label",{className:"text-xs",children:["水平回転 ",Math.round(180*o/Math.PI),"\xb0"]})}),(0,a.jsx)("input",{type:"range",min:-Math.PI,max:Math.PI,step:.05,value:o,onChange:e=>d(parseFloat(e.target.value)),className:"w-full h-1 bg-gray-600 rounded appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsxs)("label",{className:"text-xs",children:["垂直回転 ",Math.round(180*u/Math.PI),"\xb0"]})}),(0,a.jsx)("input",{type:"range",min:-Math.PI/2,max:Math.PI/2,step:.05,value:u,onChange:e=>h(parseFloat(e.target.value)),className:"w-full h-1 bg-gray-600 rounded appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsxs)("label",{className:"text-xs",children:["サイズ ",Math.round(100*s)/100,"x"]})}),(0,a.jsx)("input",{type:"range",min:.1,max:5,step:.1,value:s,onChange:e=>l(parseFloat(e.target.value)),className:"w-full h-1 bg-gray-600 rounded appearance-none cursor-pointer"})]})]}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 bg-black bg-opacity-70 text-white p-3 rounded-lg text-xs max-w-xs",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-2",children:"平面検出AR"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{children:["状態: ",p?"平面検出完了✓":"平面を検出中..."]}),(0,a.jsx)("div",{children:"1. 床面や机にカメラを向ける"}),(0,a.jsx)("div",{children:"2. 平面が検出されると3Dモデルが表示"}),(0,a.jsx)("div",{children:"3. 右側のスライダーで調整可能"})]})]}),(0,a.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:(0,a.jsx)("button",{type:"button",onClick:()=>{var r;f(!0),setTimeout(()=>f(!1),150);let a=null==(r=e.current)?void 0:r.querySelector("canvas"),n=t.current;if(a){let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=a.width,e.height=a.height,t){n&&n.videoWidth>0&&t.drawImage(n,0,0,e.width,e.height),t.drawImage(a,0,0);let r=e.toDataURL("image/png"),i=document.createElement("a");i.download="ar-photo-".concat(Date.now(),".png"),i.href=r,i.click()}}},className:"w-16 h-16 bg-white bg-opacity-20 backdrop-blur-md rounded-full flex items-center justify-center border-3 border-white transition-all hover:scale-110 active:scale-95",title:"AR写真を撮影",children:(0,a.jsx)(c,{className:"w-8 h-8 text-white"})})}),m&&(0,a.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,a.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:(0,a.jsx)("div",{onClick:()=>{i(!0)},className:"flex items-center justify-center h-full cursor-pointer bg-gradient-to-br from-gray-900 to-black",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 bg-white bg-opacity-10 rounded-full flex items-center justify-center backdrop-blur-sm transition-transform hover:scale-110",children:(0,a.jsx)(c,{className:"w-16 h-16 text-white"})}),(0,a.jsx)("p",{className:"text-white text-lg font-light mb-2",children:"AR体験を開始"}),(0,a.jsx)("p",{className:"text-white text-sm opacity-80",children:"床面を向けて平面検出を開始"})]})})})}}}]);