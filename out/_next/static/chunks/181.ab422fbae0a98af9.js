"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{5181:(e,t,l)=>{l.r(t),l.d(t,{default:()=>u});var r=l(5155),n=l(2115),a=l(3264),i=l(7431),s=l(5198),o=l(4355),c=l(9523),d=l(9699);let u=()=>{let e=(0,n.useRef)(null);(0,n.useRef)(null);let t=(0,n.useRef)(null),l=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null),h=(0,n.useRef)(null),g=(0,n.useRef)(null),f=(0,n.useRef)(null),w=(0,n.useRef)(null),[p,x]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),[y,k]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),E=(0,n.useRef)([]),M=(0,n.useRef)(null),C=(0,n.useRef)([]);(0,n.useEffect)(()=>{new s.B().load("/wkwk.glb",e=>{M.current=e.scene.clone(),console.log("wkwk model loaded for bubbles")},void 0,e=>{console.error("Error loading wkwk GLB model:",e),N("モデル読み込みエラー")})},[]);let R=e=>{if(!e.multiHandLandmarks)return;let t=[];e.multiHandLandmarks.forEach(e=>{let r=[e[0],e[5],e[9],e[13],e[17]],n=0,i=0,s=0;r.forEach(e=>{n+=e.x,i+=e.y,s+=e.z}),n/=r.length,i/=r.length,s/=r.length;let o=(n-.5)*4,c=-(3*(i-.5)),d=-(2*s),u=new a.Pq0(o,c,d);t.push(u),.2>Math.random()&&(e=>{if(!M.current||!l.current)return;let t=Math.random()*Math.PI*2,r=.01+.02*Math.random(),n={id:Math.random().toString(36).substr(2,9),model:M.current.clone(),velocity:new a.Pq0(Math.cos(t)*r,.015*Math.random()+.01,Math.sin(t)*r),life:0,maxLife:3+2*Math.random(),scale:0,targetScale:.05+.1*Math.random()};n.model.position.copy(e),n.model.scale.setScalar(0),n.model.traverse(e=>{e.isMesh&&(e.material=e.material.clone(),e.material.transparent=!0,e.material.opacity=.8)}),l.current.add(n.model),E.current.push(n)})(u)}),C.current=t};return(0,n.useEffect)(()=>{if(!p)return;console.log("useEffect triggered with isActive:",p,"isLoaded:",b);let r=async()=>{try{console.log("Starting hand tracking initialization"),u.current&&(console.log("Cleaning up existing renderer"),u.current.dispose(),e.current&&u.current.domElement.parentNode&&e.current.removeChild(u.current.domElement),u.current=null);let r=window.innerWidth,n=window.innerHeight,s=new a.Z58;l.current=s;let o=new a.ubm(75,r/n,.1,1e3);o.position.z=3,m.current=o;let p=new i.JeP({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});p.setSize(r,n),p.setPixelRatio(window.devicePixelRatio),p.setClearColor(0,0),u.current=p,e.current&&e.current.appendChild(p.domElement);let x=new a.$p8(0xffffff,.6);s.add(x);let b=new a.ZyN(0xffffff,.8);b.position.set(1,1,1),s.add(b);let y=new c.Hands({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/hands/".concat(e)});y.setOptions({maxNumHands:1,modelComplexity:0,minDetectionConfidence:.7,minTrackingConfidence:.7}),y.onResults(R),g.current=y;let k=t.current;if(k){console.log("=== CAMERA INITIALIZATION ===");let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1}),t=e.getVideoTracks()[0].getSettings();console.log("Camera stream obtained with settings:",t),console.log("Actual facing mode used:",t.facingMode),k.srcObject=e,await k.play(),w.current=e;let l=new d.Camera(k,{onFrame:async()=>{g.current&&await g.current.send({image:k})},width:640,height:480});await l.start(),f.current=l,console.log("MediaPipe camera started successfully")}v(!0);let j=()=>{h.current=requestAnimationFrame(j),(()=>{let e=E.current;for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.life+=.016,n.model.position.add(n.velocity),n.life<.5)n.scale=a.cj9.lerp(0,n.targetScale,2*n.life);else if(n.life>n.maxLife-1){let e=n.maxLife-n.life;n.scale=a.cj9.lerp(0,n.targetScale,e)}else n.scale=n.targetScale;if(n.model.scale.setScalar(n.scale),n.life>n.maxLife-1){let e=n.maxLife-n.life;n.model.traverse(t=>{t.isMesh&&(t.material.opacity=.8*e)})}if(n.life>=n.maxLife){var t;null==(t=l.current)||t.remove(n.model),e.splice(r,1)}}})(),p.render(s,o)};j();let N=()=>{let e=window.innerWidth,t=window.innerHeight;o.aspect=e/t,o.updateProjectionMatrix(),p.setSize(e,t)};return window.addEventListener("resize",N),()=>{if(window.removeEventListener("resize",N),h.current&&cancelAnimationFrame(h.current),g.current){try{g.current.close()}catch(e){console.warn("Error closing hands during cleanup:",e)}g.current=null}if(f.current){try{f.current.stop()}catch(e){console.warn("Error stopping MediaPipe camera during cleanup:",e)}f.current=null}w.current&&(w.current.getTracks().forEach(e=>e.stop()),w.current=null),p.dispose()}}catch(e){console.error("Failed to initialize hand tracking:",e),N("初期化エラー: "+e.message),v(!0)}};b||(console.log("Triggering initHandTracking because isLoaded is false"),r())},[p,b,R]),(0,r.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0}),(0,r.jsx)("div",{ref:e,className:"absolute top-0 left-0 w-full h-full"}),!b&&(0,r.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,r.jsx)("div",{className:"text-sm text-center",children:"手追跡を初期化中..."})}),b&&j&&(0,r.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-600 bg-opacity-80 text-white px-4 py-2 rounded-lg",children:(0,r.jsx)("div",{className:"text-sm text-center",children:j})}),(0,r.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"10%"},children:(0,r.jsx)("button",{type:"button",onClick:()=>{let e,r,n,a;if(!u.current||!t.current)return;k(!0),setTimeout(()=>k(!1),150);let i=u.current,s=l.current,o=m.current;if(!s||!o)return;i.render(s,o);let c=document.createElement("canvas"),d=c.getContext("2d");if(!d)return;let h=t.current,g=i.domElement,f=h.videoWidth/h.videoHeight,w=window.innerWidth/window.innerHeight,p=0,x=0;f>w?(e=h.videoWidth,r=h.videoWidth/w):(e=h.videoHeight*w,r=h.videoHeight),n=h.videoWidth,a=h.videoHeight,c.width=e,c.height=r,p=(e-n)/2,x=(r-a)/2,d.drawImage(h,p,x,n,a),d.globalCompositeOperation="source-over",d.drawImage(g,0,0,e,r),console.log("Video resolution:",h.videoWidth,"x",h.videoHeight),console.log("Video aspect ratio:",f),console.log("Screen aspect ratio:",w),console.log("Canvas size:",e,"x",r),console.log("Video draw size:",n,"x",a);let b=c.toDataURL("image/png"),v=document.createElement("a");v.download="hand-bubbles-".concat(Date.now(),".png"),v.href=b,v.click()},className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-36 xl:h-36 backdrop-blur-xl rounded-full flex items-center justify-center border-2 border-white border-opacity-20 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(34, 197, 94, 0.8))",boxShadow:"0 8px 32px rgba(59, 130, 246, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.1)"},children:(0,r.jsx)(o.A,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 xl:w-18 xl:h-18 text-white drop-shadow-lg"})})}),y&&(0,r.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"}),b&&!j&&(0,r.jsx)("div",{className:"absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-2 rounded-lg",children:(0,r.jsx)("div",{className:"text-sm",children:"手を動かして泡を生成しよう！"})})]}):(0,r.jsx)("div",{onClick:()=>{x(!0)},className:"relative flex items-center justify-center h-full cursor-pointer overflow-hidden",style:{background:"linear-gradient(135deg, #1e1b4b 0%, #312e81 25%, #3730a3 50%, #1e1b4b 75%, #312e81 100%)",backgroundSize:"400% 400%",animation:"waveGradient 15s ease infinite"},children:(0,r.jsxs)("div",{className:"text-center relative z-10",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.A,{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 text-white drop-shadow-2xl animate-bounce mx-auto"})}),(0,r.jsx)("p",{className:"text-white text-lg sm:text-xl font-light drop-shadow-lg mb-4",children:"タップして手追跡を開始"}),(0,r.jsx)("p",{className:"text-white text-sm opacity-75 drop-shadow-lg",children:"手を動かして泡のようなwkwkを生成"})]})})})}}}]);