"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[138],{4355:(e,o,n)=>{n.d(o,{A:()=>l});let l=(0,n(7565).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},5138:(e,o,n)=>{n.r(o),n.d(o,{default:()=>s});var l=n(5155),t=n(2115),i=n(5169);let r=(0,n(7565).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var a=n(4355);let s=()=>{let e=(0,t.useRef)(null),[o,n]=(0,t.useState)(!1),[s,d]=(0,t.useState)(!1),[c,w]=(0,t.useState)(null),[h,u]=(0,t.useState)("coicoi"),g=(0,t.useRef)(null),m=(0,t.useRef)(null),p=(0,t.useRef)(null),x=(0,t.useRef)(null),A=(0,t.useRef)([]),E={coicoi:{mindFile:"/targets.mind",modelFile:"/coicoi.glb",modelName:"coicoi画像"},wkwk:{mindFile:"/targets.mind",modelFile:"/wkwk.glb",modelName:"wkwk画像"}};(0,t.useEffect)(()=>{(async()=>{try{var e,o,l,t,i,r,a,s;if(console.log("Checking libraries..."),console.log("window.THREE:",!!window.THREE),console.log("window.MINDAR:",!!window.MINDAR),window.THREE&&window.MINDAR&&(null==(e=window.MINDAR)?void 0:e.IMAGE)||(console.log("Loading Three.js and MindAR libraries..."),window.THREE||(console.log("Loading Three.js..."),await new Promise((e,o)=>{let n=document.createElement("script");n.src="https://unpkg.com/three@0.147.0/build/three.min.js",n.onload=()=>{console.log("Three.js loaded successfully"),console.log("window.THREE:",!!window.THREE),e()},n.onerror=()=>{console.error("Failed to load Three.js"),o(Error("Failed to load Three.js"))},document.head.appendChild(n)}),await new Promise(e=>setTimeout(e,500))),(null==(t=window.THREE)?void 0:t.GLTFLoader)||(console.log("Loading GLTFLoader..."),await new Promise((e,o)=>{let n=document.createElement("script");n.src="https://unpkg.com/three@0.147.0/examples/js/loaders/GLTFLoader.js",n.onload=()=>{console.log("GLTFLoader loaded successfully"),console.log("window.THREE.GLTFLoader:",!!window.THREE.GLTFLoader),e()},n.onerror=()=>{console.error("Failed to load GLTFLoader"),o(Error("Failed to load GLTFLoader"))},document.head.appendChild(n)}),await new Promise(e=>setTimeout(e,500))),(null==(i=window.MINDAR)?void 0:i.IMAGE)||(console.log("Loading MindAR..."),await new Promise((e,o)=>{let n=document.createElement("script");n.src="https://unpkg.com/mind-ar@1.2.5/dist/mindar-image-three.prod.js",n.onload=()=>{console.log("MindAR script loaded"),setTimeout(()=>{var n,l,t,i,r;console.log("window.MINDAR:",!!window.MINDAR),console.log("window.MINDAR.IMAGE:",!!(null==(n=window.MINDAR)?void 0:n.IMAGE)),console.log("window.MINDAR.IMAGE.MindARThree:",!!(null==(t=window.MINDAR)||null==(l=t.IMAGE)?void 0:l.MindARThree)),(null==(r=window.MINDAR)||null==(i=r.IMAGE)?void 0:i.MindARThree)?(console.log("MindAR loaded successfully with IMAGE support"),e()):o(Error("MindAR loaded but IMAGE not available"))},1e3)},n.onerror=()=>{console.error("Failed to load MindAR script"),o(Error("Failed to load MindAR script"))},document.head.appendChild(n)})),console.log("Final library check:"),console.log("window.THREE:",!!window.THREE),console.log("window.MINDAR:",!!window.MINDAR),console.log("window.MINDAR.IMAGE:",!!(null==(r=window.MINDAR)?void 0:r.IMAGE)),console.log("window.MINDAR.IMAGE.MindARThree:",!!(null==(s=window.MINDAR)||null==(a=s.IMAGE)?void 0:a.MindARThree))),!window.THREE)throw Error("Three.js not available");if(!(null==(l=window.MINDAR)||null==(o=l.IMAGE)?void 0:o.MindARThree))throw Error("MindAR IMAGE not available");console.log("All libraries loaded and validated successfully"),n(!0)}catch(e){console.error("Failed to load libraries:",e),w("ARライブラリの読み込みに失敗しました: ".concat(e.message||e))}})()},[]);let f=async()=>{if(!e.current)return void w("コンテナが見つかりません");try{var o,n,l,t,i;if(console.log("Starting Three.js AR initialization..."),console.log("Pre-init library check:"),console.log("window.THREE:",!!window.THREE),console.log("window.MINDAR:",!!window.MINDAR),console.log("window.MINDAR.IMAGE:",!!(null==(o=window.MINDAR)?void 0:o.IMAGE)),console.log("window.MINDAR.IMAGE.MindARThree:",!!(null==(l=window.MINDAR)||null==(n=l.IMAGE)?void 0:n.MindARThree)),!(null==(i=window.MINDAR)||null==(t=i.IMAGE)?void 0:t.MindARThree))throw Error("MindAR IMAGE not available at initialization time. Please reload the page.");let r=E[h];console.log("Using marker config:",r),console.log("Creating MindARThree instance...");let a=new window.MINDAR.IMAGE.MindARThree({container:e.current,imageTargetSrc:r.mindFile,filterMinCF:1e-4,filterBeta:1e3,missTolerance:5,warmupTolerance:5});g.current=a;let{renderer:s,scene:c,camera:w}=a;m.current=s,p.current=c,x.current=w,console.log("MindAR Three.js initialized");let u=new window.THREE.AmbientLight(0xffffff,.6);c.add(u);let f=new window.THREE.DirectionalLight(0xffffff,.8);f.position.set(0,1,1),c.add(f);let R=new window.THREE.GLTFLoader,b=a.addAnchor(0),M=new window.THREE.BoxGeometry(.5,.5,.5),T=new window.THREE.MeshBasicMaterial({color:0xff0000}),N=new window.THREE.Mesh(M,T);N.position.set(0,.5,0),b.group.add(N),R.load("/coicoi.glb",e=>{console.log("Coicoi model loaded");let o=e.scene;if(o.scale.set(1,1,1),o.position.set(0,0,0),b.group.add(o),e.animations&&e.animations.length>0){let n=new window.THREE.AnimationMixer(o);e.animations.forEach(e=>{n.clipAction(e).play()}),A.current.push(n)}},void 0,e=>{console.error("Error loading coicoi model:",e)});let k=a.addAnchor(1),v=new window.THREE.BoxGeometry(.5,.5,.5),j=new window.THREE.MeshBasicMaterial({color:0xffff00}),y=new window.THREE.Mesh(v,j);y.position.set(0,.5,0),k.group.add(y),R.load("/wkwk.glb",e=>{console.log("WKWK model loaded");let o=e.scene;if(o.scale.set(1,1,1),o.position.set(0,0,0),k.group.add(o),e.animations&&e.animations.length>0){let n=new window.THREE.AnimationMixer(o);e.animations.forEach(e=>{n.clipAction(e).play()}),A.current.push(n)}},void 0,e=>{console.error("Error loading wkwk model:",e)}),b.onTargetFound=()=>{console.log("\uD83C\uDFAF Coicoi target found!")},b.onTargetLost=()=>{console.log("❌ Coicoi target lost!")},k.onTargetFound=()=>{console.log("\uD83C\uDFAF WKWK target found!")},k.onTargetLost=()=>{console.log("❌ WKWK target lost!")},await a.start(),console.log("✅ MindAR Three.js started successfully");let I=new window.THREE.Clock,G=()=>{requestAnimationFrame(G);let e=I.getDelta();A.current.forEach(o=>{o.update(e)}),s.render(c,w)};G(),d(!0)}catch(e){console.error("AR initialization failed:",e),w("AR初期化に失敗しました: "+((null==e?void 0:e.message)||e))}},R=async()=>{try{g.current&&(await g.current.stop(),g.current=null),A.current=[],e.current&&(e.current.innerHTML=""),d(!1),console.log("AR stopped")}catch(e){console.error("Error stopping AR:",e)}},b=async()=>{await R(),setTimeout(()=>f(),500)};return(0,l.jsxs)("div",{className:"fixed inset-0 bg-black overflow-hidden",children:[(0,l.jsx)("div",{ref:e,className:"fixed inset-0",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",margin:0,padding:0}}),(0,l.jsx)("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/50 to-transparent z-10",children:(0,l.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,l.jsxs)("button",{onClick:()=>{R(),window.location.href="/start"},className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,l.jsx)(i.A,{className:"w-5 h-5"}),"戻る"]}),(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Three.js画像認識AR"}),(0,l.jsxs)("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,l.jsx)(r,{className:"w-5 h-5"}),"リセット"]})]})}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent z-10",children:(0,l.jsxs)("div",{className:"text-white text-center space-y-2",children:[(0,l.jsx)("p",{className:"text-sm opacity-90",children:"認識させたい画像をカメラに向けてください"}),(0,l.jsx)("div",{className:"flex justify-center space-x-4 text-xs",children:(0,l.jsx)("span",{className:"bg-black/50 px-3 py-1 rounded",children:"Three.js版で動作中"})})]})}),o&&!s&&!c&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20",children:(0,l.jsxs)("div",{className:"text-white text-center",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Three.js AR開始"}),(0,l.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,l.jsx)("button",{onClick:()=>u("coicoi"),className:"px-6 py-3 rounded-lg transition-colors ".concat("coicoi"===h?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"coicoi画像"}),(0,l.jsx)("button",{onClick:()=>u("wkwk"),className:"px-6 py-3 rounded-lg transition-colors ".concat("wkwk"===h?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"wkwk画像"})]}),(0,l.jsxs)("button",{onClick:f,className:"flex items-center gap-3 px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-lg font-semibold transition-colors mx-auto",children:[(0,l.jsx)(a.A,{className:"w-6 h-6"}),"Three.js ARを開始"]})]})}),!o&&!c&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,l.jsxs)("div",{className:"text-white text-center",children:[(0,l.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-cyan-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,l.jsx)("p",{children:"Three.js & MindARライブラリを読み込み中..."})]})}),c&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,l.jsxs)("div",{className:"text-white text-center max-w-md mx-4",children:[(0,l.jsx)("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),(0,l.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"エラーが発生しました"}),(0,l.jsx)("p",{className:"text-gray-300 mb-4",children:c}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"block w-full px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors",children:"再試行"}),(0,l.jsx)("button",{onClick:()=>{window.location.href="/start"},className:"block w-full px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"スタート画面に戻る"})]})]})})]})}},5169:(e,o,n)=>{n.d(o,{A:()=>l});let l=(0,n(7565).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7565:(e,o,n)=>{n.d(o,{A:()=>s});var l=n(2115);let t=e=>{let o=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,o,n)=>n?n.toUpperCase():o.toLowerCase());return o.charAt(0).toUpperCase()+o.slice(1)},i=function(){for(var e=arguments.length,o=Array(e),n=0;n<e;n++)o[n]=arguments[n];return o.filter((e,o,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===o).join(" ").trim()};var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,l.forwardRef)((e,o)=>{let{color:n="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:d="",children:c,iconNode:w,...h}=e;return(0,l.createElement)("svg",{ref:o,...r,width:t,height:t,stroke:n,strokeWidth:s?24*Number(a)/Number(t):a,className:i("lucide",d),...!c&&!(e=>{for(let o in e)if(o.startsWith("aria-")||"role"===o||"title"===o)return!0})(h)&&{"aria-hidden":"true"},...h},[...w.map(e=>{let[o,n]=e;return(0,l.createElement)(o,n)}),...Array.isArray(c)?c:[c]])}),s=(e,o)=>{let n=(0,l.forwardRef)((n,r)=>{let{className:s,...d}=n;return(0,l.createElement)(a,{ref:r,iconNode:o,className:i("lucide-".concat(t(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),s),...d})});return n.displayName=t(e),n}}}]);