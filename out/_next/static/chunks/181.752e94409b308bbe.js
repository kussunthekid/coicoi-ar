"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{5181:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var i=a(5155),l=a(2115),r=a(3264),n=a(7431),o=a(5198),s=a(4355),d=a(5169),c=a(9523),u=a(9699);let m=()=>{let e=(0,l.useRef)(null);(0,l.useRef)(null);let t=(0,l.useRef)(null),a=(0,l.useRef)(null),m=(0,l.useRef)(null),h=(0,l.useRef)(null),w=(0,l.useRef)(null),g=(0,l.useRef)(null),f=(0,l.useRef)(null),p=(0,l.useRef)(null),[x,v]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[M,k]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),E=(0,l.useRef)([]),S=(0,l.useRef)(null),z=(0,l.useRef)([]);(0,l.useEffect)(()=>{new o.B().load("/wkwk.glb",e=>{S.current=e.scene.clone(),console.log("wkwk model loaded for bubbles")},void 0,e=>{console.error("Error loading wkwk GLB model:",e),N("モデル読み込みエラー")})},[]);let C=e=>{if(!e.multiHandLandmarks)return;let t=[];e.multiHandLandmarks.forEach(i=>{let l=[i[0],i[1],i[5],i[9],i[13],i[17],i[2]],n=0,o=0,s=0;l.forEach(e=>{n+=e.x,o+=e.y,s+=e.z}),n/=l.length,o/=l.length,s/=l.length;let d=(n-.5)*4,c=-(3*(o-.5)),u=-(2*s),m=new r.Pq0(d,c,u);if(t.push(m),Math.random()<(2===e.multiHandLandmarks.length?.15:.2)){let e=m.clone();e.x+=(Math.random()-.5)*.1,e.y+=(Math.random()-.5)*.1,(e=>{if(!S.current||!a.current)return;let t=Math.random()*Math.PI*2,i=.008+.015*Math.random(),l=Math.random()*Math.PI*2,n={id:Math.random().toString(36).substr(2,9),model:S.current.clone(),velocity:new r.Pq0(Math.cos(t)*i+.005*Math.cos(l),.015*Math.random()+.012,Math.sin(t)*i+.005*Math.sin(l)),life:0,maxLife:6+4*Math.random(),scale:0,targetScale:.05+.1*Math.random(),rotationSpeed:new r.Pq0((Math.random()-.5)*.02,(Math.random()-.5)*.016,(Math.random()-.5)*.01)};n.model.position.copy(e),n.model.scale.setScalar(0),n.model.traverse(e=>{if(e.isMesh){if(e.material=e.material.clone(),e.material.transparent=!0,e.material.opacity=.9,e.material.emissive.setHex(2236962),e.material.emissiveIntensity=.1,e.material.color){let t=e.material.color;t.r=Math.min(1,1.3*t.r),t.g=Math.min(1,1.3*t.g),t.b=Math.min(1,1.3*t.b)}e.material.metalness=.1,e.material.roughness=.7}}),a.current.add(n.model),E.current.push(n)})(e)}}),z.current=t};return(0,l.useEffect)(()=>{if(!x)return;console.log("useEffect triggered with isActive:",x,"isLoaded:",b);let i=async()=>{try{var i,l;console.log("Starting hand tracking initialization"),m.current&&(console.log("Cleaning up existing renderer"),m.current.dispose(),e.current&&m.current.domElement.parentNode&&e.current.removeChild(m.current.domElement),m.current=null);let o=(null==(i=window.visualViewport)?void 0:i.width)||window.innerWidth,s=(null==(l=window.visualViewport)?void 0:l.height)||window.innerHeight,d=new r.Z58;a.current=d;let x=new r.ubm(75,o/s,.1,1e3);x.position.z=3,h.current=x;let v=new n.JeP({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});v.setSize(o,s),v.setPixelRatio(window.devicePixelRatio),v.setClearColor(0,0),m.current=v,e.current&&e.current.appendChild(v.domElement);let b=new r.$p8(0xffffff,.6);d.add(b);let M=new r.ZyN(0xffffff,.8);M.position.set(1,1,1),d.add(M);let k=new c.Hands({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/hands/".concat(e)});k.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),k.onResults(C),g.current=k;let j=t.current;if(j){console.log("=== CAMERA INITIALIZATION ===");let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}},audio:!1}),t=e.getVideoTracks()[0].getSettings();console.log("Camera stream obtained with settings:",t),console.log("Actual facing mode used:",t.facingMode),j.srcObject=e,await j.play(),p.current=e;let a=new u.Camera(j,{onFrame:async()=>{g.current&&await g.current.send({image:j})},width:640,height:480});await a.start(),f.current=a,console.log("MediaPipe camera started successfully")}y(!0);let N=()=>{w.current=requestAnimationFrame(N),(()=>{let e=E.current;for(let i=e.length-1;i>=0;i--){let l=e[i];l.life+=.015;let n=l.life,o=.003*Math.sin(2.5*n),s=.004*Math.cos(1.8*n);if(l.velocity.y*=.998,l.velocity.x*=.995,l.velocity.z*=.995,.02>Math.random()&&(l.velocity.x+=(Math.random()-.5)*.01,l.velocity.z+=(Math.random()-.5)*.01),l.model.position.x+=l.velocity.x+o,l.model.position.y+=l.velocity.y,l.model.position.z+=l.velocity.z+s,l.model.rotation.x+=l.rotationSpeed.x,l.model.rotation.y+=l.rotationSpeed.y,l.model.rotation.z+=l.rotationSpeed.z,l.life<.4)l.scale=r.cj9.lerp(0,l.targetScale,2.5*l.life);else if(l.life>l.maxLife-1.5){let e=(l.maxLife-l.life)/1.5;l.scale=r.cj9.lerp(0,l.targetScale,Math.max(0,e))}else l.scale=l.targetScale;if(l.model.scale.setScalar(l.scale),l.life>l.maxLife-2){let e=(l.maxLife-l.life)/2;l.model.traverse(t=>{t.isMesh&&(t.material.opacity=.8*e)})}if(l.life>=l.maxLife){var t;null==(t=a.current)||t.remove(l.model),e.splice(i,1)}}})(),v.render(d,x)};N();let S=()=>{var e,t;let a=(null==(e=window.visualViewport)?void 0:e.width)||window.innerWidth,i=(null==(t=window.visualViewport)?void 0:t.height)||window.innerHeight;x.aspect=a/i,x.updateProjectionMatrix(),v.setSize(a,i)};return window.addEventListener("resize",S),window.visualViewport&&window.visualViewport.addEventListener("resize",S),()=>{if(window.removeEventListener("resize",S),window.visualViewport&&window.visualViewport.removeEventListener("resize",S),w.current&&cancelAnimationFrame(w.current),g.current){try{g.current.close()}catch(e){console.warn("Error closing hands during cleanup:",e)}g.current=null}if(f.current){try{f.current.stop()}catch(e){console.warn("Error stopping MediaPipe camera during cleanup:",e)}f.current=null}p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null),v.dispose()}}catch(e){console.error("Failed to initialize hand tracking:",e),N("初期化エラー: "+e.message),y(!0)}};b||(console.log("Triggering initHandTracking because isLoaded is false"),i())},[x,b,C]),(0,i.jsx)("div",{className:"relative w-screen h-screen overflow-hidden bg-black",style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh"},children:x?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("video",{ref:t,className:"absolute top-0 left-0 w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0}),(0,i.jsx)("div",{ref:e,className:"absolute top-0 left-0 w-full h-full pointer-events-none"}),!b&&(0,i.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,i.jsx)("div",{className:"text-sm text-center",children:"手追跡を初期化中..."})}),b&&j&&(0,i.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-600 bg-opacity-80 text-white px-4 py-2 rounded-lg",children:(0,i.jsx)("div",{className:"text-sm text-center",children:j})}),(0,i.jsx)("button",{type:"button",onClick:()=>{window.location.href="/start"},className:"absolute bottom-[10%] left-[15%] w-12 h-12 sm:w-14 sm:h-14 backdrop-blur-xl rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 shadow-2xl transition-all hover:scale-105 active:scale-95",title:"戻る",style:{background:"linear-gradient(135deg, rgba(75, 85, 99, 0.4), rgba(55, 65, 81, 0.2))",boxShadow:"0 8px 32px rgba(75, 85, 99, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:(0,i.jsx)(d.A,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),(0,i.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"10%"},children:(0,i.jsx)("button",{type:"button",onClick:()=>{var e,i;let l,r;if(!m.current||!t.current)return;k(!0),setTimeout(()=>k(!1),150);let n=m.current,o=a.current,s=h.current;if(!o||!s)return;let d=t.current,c=n.domElement,u=(null==(e=window.visualViewport)?void 0:e.width)||window.innerWidth,w=(null==(i=window.visualViewport)?void 0:i.height)||window.innerHeight,g=d.videoWidth/d.videoHeight,f=0,p=0;g>u/w?(r=w,f=(u-(l=w*g))/2):(l=u,p=(w-(r=u/g))/2);let x=document.createElement("canvas"),v=x.getContext("2d");if(!v)return;x.width=u,x.height=w,v.drawImage(d,0,0,d.videoWidth,d.videoHeight,f,p,l,r),v.globalCompositeOperation="source-over",v.drawImage(c,0,0,c.width,c.height,0,0,u,w),console.log("Display size:",u,"x",w),console.log("Video resolution:",d.videoWidth,"x",d.videoHeight),console.log("Video display size:",l,"x",r),console.log("Video offset:",f,"x",p),console.log("Three.js canvas size:",c.width,"x",c.height);let b=x.toDataURL("image/png"),y=document.createElement("a");y.download="hand-bubbles-".concat(Date.now(),".png"),y.href=b,y.click()},className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-36 xl:h-36 backdrop-blur-xl rounded-full flex items-center justify-center border-2 border-white border-opacity-20 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(34, 197, 94, 0.8))",boxShadow:"0 8px 32px rgba(59, 130, 246, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.1)"},children:(0,i.jsx)(s.A,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 xl:w-18 xl:h-18 text-white drop-shadow-lg"})})}),M&&(0,i.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,i.jsx)("div",{onClick:()=>{v(!0)},className:"relative flex items-center justify-center h-full cursor-pointer overflow-hidden",style:{background:"linear-gradient(135deg, #1e1b4b 0%, #312e81 25%, #3730a3 50%, #1e1b4b 75%, #312e81 100%)",backgroundSize:"400% 400%",animation:"waveGradient 15s ease infinite"},children:(0,i.jsxs)("div",{className:"text-center relative z-10",children:[(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsx)(s.A,{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 text-white drop-shadow-2xl animate-bounce mx-auto"})}),(0,i.jsx)("p",{className:"text-white text-lg sm:text-xl font-light drop-shadow-lg mb-4",children:"タップして手追跡を開始"}),(0,i.jsx)("p",{className:"text-white text-sm opacity-75 drop-shadow-lg",children:"手を動かして泡のようなwkwkを生成"})]})})})}}}]);