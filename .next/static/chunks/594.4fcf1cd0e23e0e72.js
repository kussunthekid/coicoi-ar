"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[594],{1594:(e,t,o)=>{o.r(t),o.d(t,{default:()=>c});var n=o(5155),r=o(2115),a=o(5169),i=o(4355),l=o(5695);let c=()=>{let e=(0,l.useRouter)(),t=(0,r.useRef)(null),[o,c]=(0,r.useState)(!1),[s,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(null),[g,h]=(0,r.useState)(.114),[p,f]=(0,r.useState)(.0095),y=(0,r.useRef)(null),b=(0,r.useRef)(.114),v=(0,r.useRef)(.0095);(0,r.useEffect)(()=>((async()=>{try{if(!window.MINDAR||!window.AFRAME){for(let e of(console.log("Loading MindAR and A-Frame libraries..."),["https://aframe.io/releases/1.3.0/aframe.min.js","https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"]))await new Promise((t,o)=>{let n=document.createElement("script");n.src=e,n.async=!1,n.onload=()=>{console.log("Loaded: ".concat(e)),t()},n.onerror=()=>{console.error("Failed to load: ".concat(e)),o(Error("Failed to load ".concat(e)))},document.head.appendChild(n)});await new Promise(e=>setTimeout(e,500)),console.log("All libraries loaded")}c(!0)}catch(e){console.error("Failed to load libraries:",e),u("ARライブラリの読み込みに失敗しました。")}})(),()=>{console.log("MarkerARFrame component unmounting, cleaning up..."),(async()=>{await w()})()}),[]);let x=async()=>{if(!t.current)return void u("コンテナが見つかりません");try{console.log("Starting AR initialization..."),console.log("Requesting camera permission...");try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});console.log("✅ Camera permission granted"),e.getTracks().forEach(e=>e.stop())}catch(e){console.error("Camera permission denied:",e),u("カメラへのアクセスが拒否されました。ブラウザの設定を確認してください。");return}console.log("Starting AR initialization with both targets"),console.log("Checking targets.mind file...");try{let e=await fetch("/targets.mind");if(!e.ok)throw Error("targets.mind not found: ".concat(e.status));console.log("✅ targets.mind file found")}catch(e){console.error("targets.mind check failed:",e),u("ターゲットファイルが見つかりません");return}let e=document.createElement("style");e.setAttribute("data-mindar-fullscreen","true"),e.textContent="\n        html, body {\n          margin: 0 !important;\n          padding: 0 !important;\n          overflow: hidden !important;\n          width: 100% !important;\n          height: 100% !important;\n        }\n        .mindar-ui-overlay {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100% !important;\n          height: 100% !important;\n          z-index: 2 !important;\n        }\n        .mindar-ui-scanning {\n          width: 100% !important;\n          height: 100% !important;\n          z-index: 2 !important;\n        }\n        a-scene {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          display: block !important;\n          margin: 0 !important;\n          padding: 0 !important;\n          z-index: 1 !important;\n        }\n        a-scene canvas {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100% !important;\n          height: 100% !important;\n          display: block !important;\n          z-index: 1 !important;\n        }\n        video {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100% !important;\n          height: 100% !important;\n          object-fit: cover !important;\n        }\n      ",document.head.appendChild(e);let o='\n        <a-scene\n          mindar-image="imageTargetSrc: /targets.mind; autoStart: false;"\n          color-space="sRGB"\n          renderer="colorManagement: true, physicallyCorrectLights"\n          vr-mode-ui="enabled: false"\n          device-orientation-permission-ui="enabled: false"\n          style="display: block; width: 100vw; height: 100vh;"\n        >\n          <a-assets>\n            <a-asset-item id="coicoi-model" src="/coicoi.glb"></a-asset-item>\n            <a-asset-item id="wkwk-model" src="/wkwk.glb"></a-asset-item>\n          </a-assets>\n          \n          <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>\n          \n          \x3c!-- Coicoi用 (index 0) --\x3e\n          <a-entity mindar-image-target="targetIndex: 0">\n            <a-gltf-model\n              id="model-coicoi"\n              rotation="0 0 0"\n              position="0 0 0"\n              scale="'.concat(g," ").concat(g," ").concat(g,'"\n              src="#coicoi-model"\n              animation-mixer\n            ></a-gltf-model>\n          </a-entity>\n          \n          \x3c!-- WKWK用 (index 1) --\x3e\n          <a-entity mindar-image-target="targetIndex: 1">\n            <a-gltf-model\n              id="model-wkwk"\n              rotation="0 0 0"\n              position="0 0 0"\n              scale="').concat(p," ").concat(p," ").concat(p,'"\n              src="#wkwk-model"\n              animation-mixer\n            ></a-gltf-model>\n          </a-entity>\n          \n          <a-light type="ambient" color="#ffffff" intensity="0.6"></a-light>\n          <a-light type="directional" position="0 1 1" intensity="0.8"></a-light>\n        </a-scene>\n      ');t.current.innerHTML=o,await new Promise(e=>{var o;let n=null==(o=t.current)?void 0:o.querySelector("a-scene");n?(console.log("Setting up A-Frame scene..."),n.addEventListener("loaded",()=>{console.log("✅ A-Frame scene loaded successfully"),console.log("Scene element:",n),console.log("Scene innerHTML preview:",n.innerHTML.substring(0,200));let t=n.querySelector("a-box");console.log("Test box found:",t);let o=n.querySelectorAll("[mindar-image-target]");console.log("Found ".concat(o.length," target(s) in scene")),o.forEach((e,t)=>{console.log("Setting up anchor ".concat(t,":"),e);let o=e.querySelector("a-gltf-model");if(o){console.log("Found GLTF model ".concat(t,":"),o.getAttribute("src")),console.log("Model ".concat(t," element:"),o),console.log("Model ".concat(t," attributes:"),Array.from(o.attributes).map(e=>"".concat(e.name,'="').concat(e.value,'"')));let e=o.getAttribute("src");fetch(e||"").then(t=>{if(t.ok)return console.log("✅ GLB file ".concat(e," is accessible (status: ").concat(t.status,")")),t.blob();throw Error("HTTP ".concat(t.status))}).then(t=>{console.log("✅ GLB file ".concat(e," downloaded successfully, size: ").concat(t.size," bytes"))}).catch(t=>{console.error("❌ GLB file ".concat(e," fetch failed:"),t)}),o.addEventListener("model-loaded",e=>{console.log("\uD83C\uDF89 GLTF Model ".concat(t," LOADED successfully from ").concat(o.getAttribute("src"))),console.log("Model ".concat(t," loaded event:"),e),o.object3D&&(console.log("✅ Model ".concat(t," object3D available:"),o.object3D),console.log("Model ".concat(t," children count:"),o.object3D.children.length))}),o.addEventListener("model-error",e=>{console.error("❌ GLTF Model ".concat(t," FAILED to load from ").concat(o.getAttribute("src"),":")),console.error("Model error details:",e)}),setTimeout(()=>{console.log("Checking model ".concat(t," status after 3 seconds...")),o.object3D?(console.log("✅ Model ".concat(t," has object3D:"),o.object3D),console.log("Model ".concat(t," visible:"),o.object3D.visible),console.log("Model ".concat(t," children:"),o.object3D.children),o.object3D.visible=!0,o.setAttribute("visible","true"),o.object3D.children.length>0?console.log("\uD83C\uDFAF Model ".concat(t," has ").concat(o.object3D.children.length," children - model should be visible!")):console.warn("⚠️ Model ".concat(t," object3D has no children - model may not be loaded"))):console.warn("❌ Model ".concat(t," has no object3D after 3 seconds"))},3e3)}e.addEventListener("targetFound",o=>{console.log("\uD83C\uDFAF\uD83C\uDFAF\uD83C\uDFAF Target ".concat(t," FOUND! Image recognized successfully!")),console.log("Target ".concat(t," event:"),o);let n=e.querySelector("a-entity");n&&(n.setAttribute("visible","true"),n.setAttribute("animation","property: rotation; to: 0 360 0; dur: 2000; loop: true"),console.log("✅ Entity ".concat(t," is now visible and rotating"))),e.querySelectorAll("a-box, a-text, a-sphere, a-cylinder, a-gltf-model").forEach((e,o)=>{e.setAttribute("visible","true"),console.log("Setting element ".concat(o," (").concat(e.tagName,") visible in anchor ").concat(t))});let r=e.querySelector("a-gltf-model");if(r){console.log("\uD83C\uDFAF Forcing GLTF model visibility for anchor ".concat(t)),r.setAttribute("visible","true"),r.object3D.visible=!0;let e=r.getAttribute("scale"),o=r.getAttribute("position");console.log("Model ".concat(t," current scale: ").concat(e,", position: ").concat(o)),r.setAttribute("scale","2 2 2"),r.setAttribute("position","0 0 0"),console.log("✅ GLTF model ".concat(t," should now be VISIBLE with scale 2x2x2"))}console.log("✅ All elements in anchor ".concat(t," should be visible now"))}),e.addEventListener("targetLost",()=>{console.log("❌ Target ".concat(t," lost!"));let o=e.querySelector("a-gltf-model"),n=e.querySelector("a-box"),r=e.querySelector("a-cylinder"),a=e.querySelector("a-sphere");o&&o.setAttribute("visible","false"),n&&n.setAttribute("material",0===t?"color: red":"color: yellow"),r&&r.setAttribute("material","color: cyan"),a&&a.setAttribute("material","color: purple")})}),console.log("⏳ Waiting for MindAR to initialize..."),setTimeout(()=>{let e=n.systems["mindar-image-system"];e?(console.log("✅ MindAR system found:",e),console.log("MindAR system initialized:",e.el),console.log("MindAR system data:",e.data)):console.error("❌ MindAR system NOT found!")},2e3),n.addEventListener("arReady",()=>{console.log("\uD83C\uDFAF\uD83C\uDFAF\uD83C\uDFAF MindAR is READY! AR system initialized successfully!");let e=n.systems["mindar-image-system"];e&&e.controller&&(console.log("MindAR controller found:",e.controller),console.log("Number of targets:",e.controller.maxTrack||"unknown"),e.start&&(console.log("Starting MindAR system manually..."),e.start()));let t=document.querySelector("video"),o=document.querySelector("canvas");console.log("Initial check - Video:",!!t,"Canvas:",!!o),setTimeout(()=>{let e=document.querySelectorAll("video"),t=document.querySelectorAll("canvas");if(console.log("Found ".concat(e.length," video element(s)")),console.log("Found ".concat(t.length," canvas element(s)")),e.forEach((e,t)=>{console.log("Video ".concat(t,":"),{src:e.src||"no src",width:e.videoWidth||0,height:e.videoHeight||0,readyState:e.readyState,paused:e.paused,ended:e.ended,playing:!e.paused&&!e.ended&&e.readyState>2})}),window.AFRAME&&window.AFRAME.scenes&&window.AFRAME.scenes[0]){let e=window.AFRAME.scenes[0];console.log("A-Frame scene systems:",Object.keys(e.systems))}},3e3)}),n.addEventListener("arError",e=>{console.error("❌ MindAR error:",e.detail||e),u("カメラ初期化に失敗しました")}),n.querySelectorAll("canvas").forEach(e=>{e.style.cssText="position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; display: block !important;"}),document.querySelectorAll("video").forEach(e=>{e.style.cssText="position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; object-fit: cover !important;"}),document.querySelectorAll(".mindar-ui-overlay, .mindar-ui-scanning").forEach(e=>{e.style.cssText="position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important;"}),window.dispatchEvent(new Event("resize")),setTimeout(()=>window.dispatchEvent(new Event("resize")),100),e()})):setTimeout(e,1e3)}),d(!0),console.log("AR initialized successfully"),document.addEventListener("touchstart",e=>{if(2===e.touches.length){let t=e.touches[0],o=e.touches[1];y.current=Math.hypot(o.clientX-t.clientX,o.clientY-t.clientY)}}),document.addEventListener("touchmove",e=>{if(2===e.touches.length&&y.current){let t=e.touches[0],o=e.touches[1],n=Math.hypot(o.clientX-t.clientX,o.clientY-t.clientY),r=n/y.current,a=Math.max(.01,Math.min(.5,b.current*r)),i=Math.max(.01,Math.min(.5,v.current*r)),l=document.querySelector("#model-coicoi"),c=document.querySelector("#model-wkwk");l&&l.setAttribute("scale","".concat(a," ").concat(a," ").concat(a)),c&&c.setAttribute("scale","".concat(i," ").concat(i," ").concat(i)),b.current=a,v.current=i,h(a),f(i),y.current=n}}),document.addEventListener("touchend",()=>{y.current=null})}catch(e){console.error("AR initialization failed:",e),u("AR初期化に失敗しました")}},w=async()=>{console.log("Stopping AR session...");try{var e;let o=null==(e=t.current)?void 0:e.querySelector("a-scene");if(o&&o.systems&&o.systems["mindar-image-system"]){console.log("Stopping MindAR system...");let e=o.systems["mindar-image-system"];if(e.stop)try{await e.stop(),console.log("MindAR system stopped")}catch(e){console.error("Error stopping MindAR:",e)}if(e.pause)try{e.pause(),console.log("MindAR system paused")}catch(e){console.error("Error pausing MindAR:",e)}}if(document.querySelectorAll("video").forEach(e=>{console.log("Stopping video stream..."),e.srcObject&&(e.srcObject.getTracks().forEach(e=>{console.log("Stopping ".concat(e.kind," track...")),e.stop(),e.enabled=!1}),e.srcObject=null),e.pause(),e.src="",e.load(),e.remove()}),navigator.mediaDevices)try{let e=await navigator.mediaDevices.enumerateDevices();console.log("Found media devices:",e.length)}catch(e){console.error("Error enumerating devices:",e)}if(t.current){let e=t.current.querySelector("a-scene");e&&(e.removeEventListener("loaded",()=>{}),e.removeEventListener("arReady",()=>{}),e.removeEventListener("arError",()=>{})),t.current.innerHTML=""}let n=document.querySelector("style[data-mindar-fullscreen]");n&&n.remove(),document.querySelectorAll(".mindar-ui-overlay, .mindar-ui-scanning, .mindar-ui-loading, .mindar-ui").forEach(e=>{e.remove()}),document.querySelectorAll("a-scene, a-assets, a-camera, a-entity").forEach(e=>{e.remove()}),document.body.style.cssText="",document.documentElement.style.cssText="",document.removeEventListener("touchstart",()=>{}),document.removeEventListener("touchmove",()=>{}),document.removeEventListener("touchend",()=>{}),d(!1),console.log("AR session stopped successfully")}catch(e){console.error("Error stopping AR:",e),d(!1)}};return(0,n.jsxs)("div",{className:"fixed inset-0 bg-black overflow-hidden",children:[(0,n.jsx)("div",{ref:t,className:"fixed inset-0",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",margin:0,padding:0,zIndex:1}}),(0,n.jsx)("button",{type:"button",onClick:async()=>{console.log("Back button clicked!");try{s&&await w(),e.push("/start")}catch(t){console.error("Error during cleanup:",t),e.push("/start")}},className:"fixed bottom-6 left-6 w-16 h-16 rounded-full flex items-center justify-center backdrop-blur-md border-2 border-white/50 transition-all duration-200 active:scale-90 hover:scale-110 hover:border-white/70 cursor-pointer",style:{zIndex:0x7fffffff,background:"linear-gradient(135deg, rgba(75, 85, 99, 0.8), rgba(55, 65, 81, 0.6))",boxShadow:"0 12px 40px rgba(75, 85, 99, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.4)"},"aria-label":"戻る",children:(0,n.jsx)(a.A,{className:"w-7 h-7 text-white"})}),s&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent pointer-events-none",style:{zIndex:10},children:(0,n.jsxs)("div",{className:"text-white text-center space-y-2",children:[(0,n.jsx)("p",{className:"text-sm opacity-90",children:"認識させたい画像をカメラに向けてください"}),(0,n.jsx)("div",{className:"flex justify-center space-x-4 text-xs",children:(0,n.jsx)("span",{className:"bg-black/50 px-3 py-1 rounded",children:"両方の画像を認識中"})})]})}),o&&!s&&!m&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80",style:{zIndex:20},children:(0,n.jsx)("div",{className:"text-white text-center",children:(0,n.jsxs)("button",{type:"button",onClick:x,className:"flex items-center gap-3 px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-lg font-semibold transition-colors mx-auto",children:[(0,n.jsx)(i.A,{className:"w-6 h-6"}),"ARを開始"]})})}),!o&&!m&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black",style:{zIndex:20},children:(0,n.jsxs)("div",{className:"text-white text-center",children:[(0,n.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-cyan-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,n.jsx)("p",{children:"ARライブラリを読み込み中..."})]})}),m&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black",style:{zIndex:20},children:(0,n.jsxs)("div",{className:"text-white text-center max-w-md mx-4",children:[(0,n.jsx)("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-300 mb-4",children:m}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors",children:"再試行"})]})})]})}},4355:(e,t,o)=>{o.d(t,{A:()=>n});let n=(0,o(9946).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},5169:(e,t,o)=>{o.d(t,{A:()=>n});let n=(0,o(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5695:(e,t,o)=>{var n=o(8999);o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}})},9946:(e,t,o)=>{o.d(t,{A:()=>c});var n=o(2115);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,o)=>o?o.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return t.filter((e,t,o)=>!!e&&""!==e.trim()&&o.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:o="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:s="",children:d,iconNode:m,...u}=e;return(0,n.createElement)("svg",{ref:t,...i,width:r,height:r,stroke:o,strokeWidth:c?24*Number(l)/Number(r):l,className:a("lucide",s),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...m.map(e=>{let[t,o]=e;return(0,n.createElement)(t,o)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let o=(0,n.forwardRef)((o,i)=>{let{className:c,...s}=o;return(0,n.createElement)(l,{ref:i,iconNode:t,className:a("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...s})});return o.displayName=r(e),o}}}]);