"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[138],{4355:(e,t,o)=>{o.d(t,{A:()=>r});let r=(0,o(7565).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},5138:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var r=o(5155),n=o(2115),a=o(5169);let l=(0,o(7565).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var i=o(4355);let s=()=>{let e=(0,n.useRef)(null),[t,o]=(0,n.useState)(!1),[s,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null),[h,u]=(0,n.useState)("coicoi"),w=(0,n.useRef)(null),g=(0,n.useRef)(null),x=(0,n.useRef)(null),p=(0,n.useRef)(null),f=(0,n.useRef)([]),b={coicoi:{mindFile:"/targets.mind",modelFile:"/coicoi.glb",modelName:"coicoi画像"},wkwk:{mindFile:"/targets.mind",modelFile:"/wkwk.glb",modelName:"wkwk画像"}};(0,n.useEffect)(()=>{(async()=>{try{window.THREE&&window.MINDAR||(console.log("Loading Three.js and MindAR libraries..."),window.THREE||await new Promise((e,t)=>{let o=document.createElement("script");o.src="https://unpkg.com/three@0.147.0/build/three.min.js",o.onload=()=>{console.log("Three.js loaded"),e()},o.onerror=()=>{console.error("Failed to load Three.js"),t(Error("Failed to load Three.js"))},document.head.appendChild(o)}),window.THREE.GLTFLoader||await new Promise((e,t)=>{let o=document.createElement("script");o.src="https://unpkg.com/three@0.147.0/examples/js/loaders/GLTFLoader.js",o.onload=()=>{console.log("GLTFLoader loaded"),e()},o.onerror=()=>{console.error("Failed to load GLTFLoader"),t(Error("Failed to load GLTFLoader"))},document.head.appendChild(o)}),window.MINDAR||await new Promise((e,t)=>{let o=document.createElement("script");o.src="https://unpkg.com/mind-ar@1.2.5/dist/mindar-image-three.prod.js",o.onload=()=>{console.log("MindAR loaded"),e()},o.onerror=()=>{console.error("Failed to load MindAR"),t(Error("Failed to load MindAR"))},document.head.appendChild(o)}),await new Promise(e=>setTimeout(e,1e3)),console.log("All libraries loaded successfully")),o(!0)}catch(e){console.error("Failed to load libraries:",e),m("ARライブラリの読み込みに失敗しました。ページを再読み込みしてください。")}})()},[]);let k=async()=>{if(!e.current)return void m("コンテナが見つかりません");try{console.log("Starting Three.js AR initialization...");let t=b[h];console.log("Using marker config:",t);let o=new window.MINDAR.IMAGE.MindARThree({container:e.current,imageTargetSrc:t.mindFile,filterMinCF:1e-4,filterBeta:1e3,missTolerance:5,warmupTolerance:5});w.current=o;let{renderer:r,scene:n,camera:a}=o;g.current=r,x.current=n,p.current=a,console.log("MindAR Three.js initialized");let l=new window.THREE.AmbientLight(0xffffff,.6);n.add(l);let i=new window.THREE.DirectionalLight(0xffffff,.8);i.position.set(0,1,1),n.add(i);let s=new window.THREE.GLTFLoader,d=o.addAnchor(0),m=new window.THREE.BoxGeometry(.5,.5,.5),u=new window.THREE.MeshBasicMaterial({color:0xff0000}),k=new window.THREE.Mesh(m,u);k.position.set(0,.5,0),d.group.add(k),s.load("/coicoi.glb",e=>{console.log("Coicoi model loaded");let t=e.scene;if(t.scale.set(1,1,1),t.position.set(0,0,0),d.group.add(t),e.animations&&e.animations.length>0){let o=new window.THREE.AnimationMixer(t);e.animations.forEach(e=>{o.clipAction(e).play()}),f.current.push(o)}},void 0,e=>{console.error("Error loading coicoi model:",e)});let j=o.addAnchor(1),y=new window.THREE.BoxGeometry(.5,.5,.5),E=new window.THREE.MeshBasicMaterial({color:0xffff00}),N=new window.THREE.Mesh(y,E);N.position.set(0,.5,0),j.group.add(N),s.load("/wkwk.glb",e=>{console.log("WKWK model loaded");let t=e.scene;if(t.scale.set(1,1,1),t.position.set(0,0,0),j.group.add(t),e.animations&&e.animations.length>0){let o=new window.THREE.AnimationMixer(t);e.animations.forEach(e=>{o.clipAction(e).play()}),f.current.push(o)}},void 0,e=>{console.error("Error loading wkwk model:",e)}),d.onTargetFound=()=>{console.log("\uD83C\uDFAF Coicoi target found!")},d.onTargetLost=()=>{console.log("❌ Coicoi target lost!")},j.onTargetFound=()=>{console.log("\uD83C\uDFAF WKWK target found!")},j.onTargetLost=()=>{console.log("❌ WKWK target lost!")},await o.start(),console.log("✅ MindAR Three.js started successfully");let A=new window.THREE.Clock,T=()=>{requestAnimationFrame(T);let e=A.getDelta();f.current.forEach(t=>{t.update(e)}),r.render(n,a)};T(),c(!0)}catch(e){console.error("AR initialization failed:",e),m("AR初期化に失敗しました: "+e.message)}},j=async()=>{try{w.current&&(await w.current.stop(),w.current=null),f.current=[],e.current&&(e.current.innerHTML=""),c(!1),console.log("AR stopped")}catch(e){console.error("Error stopping AR:",e)}},y=async()=>{await j(),setTimeout(()=>k(),500)};return(0,r.jsxs)("div",{className:"fixed inset-0 bg-black overflow-hidden",children:[(0,r.jsx)("div",{ref:e,className:"fixed inset-0",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",margin:0,padding:0}}),(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/50 to-transparent z-10",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,r.jsxs)("button",{onClick:()=>{j(),window.location.href="/start"},className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,r.jsx)(a.A,{className:"w-5 h-5"}),"戻る"]}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"Three.js画像認識AR"}),(0,r.jsxs)("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,r.jsx)(l,{className:"w-5 h-5"}),"リセット"]})]})}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent z-10",children:(0,r.jsxs)("div",{className:"text-white text-center space-y-2",children:[(0,r.jsx)("p",{className:"text-sm opacity-90",children:"認識させたい画像をカメラに向けてください"}),(0,r.jsx)("div",{className:"flex justify-center space-x-4 text-xs",children:(0,r.jsx)("span",{className:"bg-black/50 px-3 py-1 rounded",children:"Three.js版で動作中"})})]})}),t&&!s&&!d&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20",children:(0,r.jsxs)("div",{className:"text-white text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Three.js AR開始"}),(0,r.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,r.jsx)("button",{onClick:()=>u("coicoi"),className:"px-6 py-3 rounded-lg transition-colors ".concat("coicoi"===h?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"coicoi画像"}),(0,r.jsx)("button",{onClick:()=>u("wkwk"),className:"px-6 py-3 rounded-lg transition-colors ".concat("wkwk"===h?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"wkwk画像"})]}),(0,r.jsxs)("button",{onClick:k,className:"flex items-center gap-3 px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-lg font-semibold transition-colors mx-auto",children:[(0,r.jsx)(i.A,{className:"w-6 h-6"}),"Three.js ARを開始"]})]})}),!t&&!d&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,r.jsxs)("div",{className:"text-white text-center",children:[(0,r.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-cyan-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,r.jsx)("p",{children:"Three.js & MindARライブラリを読み込み中..."})]})}),d&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,r.jsxs)("div",{className:"text-white text-center max-w-md mx-4",children:[(0,r.jsx)("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"エラーが発生しました"}),(0,r.jsx)("p",{className:"text-gray-300 mb-4",children:d}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"block w-full px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors",children:"再試行"}),(0,r.jsx)("button",{onClick:()=>{window.location.href="/start"},className:"block w-full px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"スタート画面に戻る"})]})]})})]})}},5169:(e,t,o)=>{o.d(t,{A:()=>r});let r=(0,o(7565).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7565:(e,t,o)=>{o.d(t,{A:()=>s});var r=o(2115);let n=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,o)=>o?o.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return t.filter((e,t,o)=>!!e&&""!==e.trim()&&o.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:o="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:m,...h}=e;return(0,r.createElement)("svg",{ref:t,...l,width:n,height:n,stroke:o,strokeWidth:s?24*Number(i)/Number(n):i,className:a("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...m.map(e=>{let[t,o]=e;return(0,r.createElement)(t,o)}),...Array.isArray(d)?d:[d]])}),s=(e,t)=>{let o=(0,r.forwardRef)((o,l)=>{let{className:s,...c}=o;return(0,r.createElement)(i,{ref:l,iconNode:t,className:a("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),s),...c})});return o.displayName=n(e),o}}}]);