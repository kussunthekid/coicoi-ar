"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{3626:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var a=r(5155),n=r(2115),l=r(3264),o=r(7431),s=r(5198),i=r(4355),d=r(1168),c=r(8021),u=r(9881),m=r(8832),h=r(5169),b=r(2138),g=r(9477);let w=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),w=(0,n.useRef)(null),p=(0,n.useRef)(null),[f,x]=(0,n.useState)(!1),[y,v]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[N,S]=(0,n.useState)(!1),[E,R]=(0,n.useState)(null),[A,C]=(0,n.useState)(0),[D,M]=(0,n.useState)("environment"),F=(0,n.useRef)(null),z=(0,n.useRef)(null),[L,P]=(0,n.useState)({x:0,y:0}),[B,Y]=(0,n.useState)(0),[q,U]=(0,n.useState)(0),[I,G]=(0,n.useState)(.83),W=(0,n.useRef)(null),_=(0,n.useRef)(null),O=(0,n.useRef)(new l.tBo),T=(0,n.useRef)(new l.I9Y),H=(0,g.useGesture)({onDrag:e=>{let{offset:[t,r]}=e;P({x:t,y:r})}}),J=(0,g.useGesture)({onDrag:e=>{let{xy:[t,a],first:n,active:l}=e;W.current&&l&&j&&(n&&console.log("Drag started"),((e,t)=>{if(!W.current||!w.current||!r.current)return;let a=r.current.domElement.getBoundingClientRect();T.current.x=(e-a.left)/a.width*2-1,T.current.y=-(2*((t-a.top)/a.height))+1,O.current.setFromCamera(T.current,w.current);let n=O.current.ray.direction,l=O.current.ray.origin,o=(0-l.y)/n.y;if(o>0){let e=l.clone().add(n.clone().multiplyScalar(o));W.current.position.x=e.x,W.current.position.z=e.z,W.current.floatData&&(W.current.floatData.baseY=.1)}})(t,a))},onPinch:e=>{let{da:[,t],first:r,memo:a}=e;if(!W.current||!j)return;if(r)return console.log("2-finger rotation started"),{initialRotation:B,initialAngle:t};let n=(t-((null==a?void 0:a.initialAngle)||0))*Math.PI/180,l=((null==a?void 0:a.initialRotation)||B)+n;return Y(l),W.current.rotation.y=l,console.log("Rotation:",Math.round(180*l/Math.PI),"\xb0"),a},onWheel:e=>{let{delta:[,t],shiftKey:r,altKey:a}=e;if(W.current&&j)if(r){let e=B+.01*t;Y(e),W.current.rotation.y=e,console.log("Shift+Scroll Rotation Y:",Math.round(180*e/Math.PI),"\xb0")}else if(a){let e=q+.01*t;U(e),W.current.rotation.x=e,console.log("Alt+Scroll Rotation X:",Math.round(180*e/Math.PI),"\xb0")}else{let e=Math.max(.5,Math.min(10,I*(1-.001*t)));G(e),W.current.scale.setScalar(e)}}},{pinch:{scaleBounds:{min:.1,max:5},rubberband:!0}});(0,n.useEffect)(()=>{f&&(async()=>{try{let a=window.innerWidth,n=window.innerHeight,i=new l.Z58;i.background=new l.Q1f(0),t.current=i;let d=a/n,c=new l.qUd(-(10*d/2),10*d/2,5,-5,.1,1e3);c.position.set(0,2,5),c.lookAt(0,0,0),w.current=c;let u=new o.JeP({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});u.setSize(a,n),u.setPixelRatio(window.devicePixelRatio),r.current=u,e.current&&e.current.appendChild(u.domElement);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1}),t=document.createElement("video");t.srcObject=e,t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),t.style.display="none",document.body.appendChild(t),await t.play();let r=()=>{let e=new l.Nv2(t);e.minFilter=l.k6q,e.magFilter=l.k6q,e.needsUpdate=!0,i.background=e,console.log("Camera background set successfully")};t.readyState>=2?r():t.addEventListener("loadedmetadata",r),F.current=e,z.current=t,u.videoElement=t,u.videoStream=e}catch(e){console.warn("Camera access failed:",e),i.background=new l.Q1f(4210752)}let m=new l.YJl;_.current=m,i.add(m);let h=new l.$p8(0xffffff,.9);i.add(h);let b=new l.ZyN(0xffffff,1.8);b.position.set(5,10,5),b.castShadow=!0,b.shadow.camera.near=.1,b.shadow.camera.far=50,b.shadow.camera.left=-10,b.shadow.camera.right=10,b.shadow.camera.top=10,b.shadow.camera.bottom=-10,b.shadow.mapSize.width=2048,b.shadow.mapSize.height=2048,i.add(b);let g=new l.dth(8900331,9139029,.8);g.position.set(0,10,0),i.add(g),u.shadowMap.enabled=!0,u.shadowMap.type=l.Wk7,S(!0),console.log("Basic AR initialized successfully"),new s.B().load("/coicoi.glb",e=>{let t=e.scene.clone();t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.scale.setScalar(.83),t.position.set(0,0,-3),t.rotation.y=0,t.floatData={baseY:0,amplitude:.3,speed:.02,time:0},W.current=t,m.add(t),k(!0),console.log("Model loaded and displayed automatically")},void 0,e=>{console.error("Error loading GLB model:",e);let t=new l.iNn(1,1,1),r=new l.V9B({color:65280,transparent:!0,opacity:.8}),a=new l.eaF(t,r);a.position.set(0,-1,-3),W.current=a,m.add(a),k(!0),console.log("Fallback cube created")});let f=a=>{a.preventDefault();let n=Date.now();n-A<300?(console.log("Double tap detected - returning to initial screen"),x(!1),k(!1),S(!1),R(null),C(0),p.current&&(cancelAnimationFrame(p.current),p.current=null),e.current&&u.domElement&&e.current.removeChild(u.domElement),u.dispose(),t.current=null,w.current=null,r.current=null,W.current=null,_.current=null):C(n)};u.domElement.addEventListener("click",f),u.domElement.addEventListener("touchend",f);let y=()=>{if(p.current=requestAnimationFrame(y),W.current&&W.current.floatData){let e=W.current.floatData;e.time+=e.speed,W.current.position.y=e.baseY+Math.sin(e.time)*e.amplitude}u.render(i,c)};y();let v=()=>{let e=window.innerWidth,t=window.innerHeight,r=e/t;c.left=-(10*r/2),c.right=10*r/2,c.top=5,c.bottom=-5,c.updateProjectionMatrix(),u.setSize(e,t)};return window.addEventListener("resize",v),()=>{if(window.removeEventListener("resize",v),u.domElement.removeEventListener("click",f),u.domElement.removeEventListener("touchend",f),p.current&&cancelAnimationFrame(p.current),u.videoElement){let e=u.videoElement;e.pause(),e.srcObject=null,e.parentNode&&e.parentNode.removeChild(e)}u.videoStream&&u.videoStream.getTracks().forEach(e=>e.stop()),e.current&&u.domElement&&e.current.removeChild(u.domElement),u.dispose()}}catch(e){console.error("Failed to initialize basic AR:",e),R("初期化エラー: "+e.message),S(!0)}})()},[f]);let Q=async()=>{if(t.current&&F.current&&z.current)try{F.current.getTracks().forEach(e=>e.stop());let e="environment"===D?"user":"environment";M(e);let r=await navigator.mediaDevices.getUserMedia({video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}},audio:!1}),a=z.current;a.srcObject=r,await a.play();let n=new l.Nv2(a);n.minFilter=l.k6q,n.magFilter=l.k6q,n.needsUpdate=!0,t.current.background=n,F.current=r,console.log("Camera switched to ".concat(e," mode"))}catch(e){console.error("Failed to switch camera:",e)}};return(0,a.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black touch-none",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{ref:e,...J(),className:"absolute top-0 left-0 w-full h-full touch-none",style:{touchAction:"none"}}),!N&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,a.jsx)("div",{className:"text-sm text-center",children:"ARカメラを初期化中..."})}),N&&E&&(0,a.jsxs)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-600 bg-opacity-80 text-white px-4 py-2 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-center",children:E}),(0,a.jsx)("div",{className:"text-xs text-center mt-1",children:"基本モードで続行"})]}),N&&(0,a.jsx)("button",{type:"button",onClick:Q,className:"absolute top-4 right-4 w-12 h-12 sm:w-14 sm:h-14 backdrop-blur-xl rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 shadow-2xl transition-all hover:scale-110 active:scale-95",title:"environment"===D?"インカメラに切り替え":"アウトカメラに切り替え",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(37, 99, 235, 0.2))",boxShadow:"0 8px 32px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:(0,a.jsx)(d.A,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white drop-shadow-lg"})}),j&&(0,a.jsxs)("div",{className:"absolute backdrop-blur-xl bg-black bg-opacity-20 rounded-3xl border border-gray-400 border-opacity-30 shadow-2xl",style:{bottom:"12%",left:"60%",transform:"translate(".concat(L.x,"px, ").concat(L.y,"px)"),cursor:"move",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1))",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.1)"},children:[(0,a.jsx)("div",{...H(),className:"flex items-center justify-center p-3 border-b border-gray-500 border-opacity-20 cursor-grab active:cursor-grabbing",title:"ドラッグして移動",children:(0,a.jsx)(c.A,{className:"w-4 h-4 text-gray-300 text-opacity-80"})}),(0,a.jsxs)("div",{className:"p-3 sm:p-4 md:p-5 lg:p-6 flex flex-col space-y-3 sm:space-y-4 md:space-y-5",children:[(0,a.jsx)("div",{className:"w-20 h-20 sm:w-28 sm:h-28 md:w-32 md:h-32 lg:w-36 lg:h-36 backdrop-blur-lg bg-gray-900 bg-opacity-8 rounded-full flex items-center justify-center border border-gray-400 border-opacity-12 shadow-inner",children:(0,a.jsxs)("div",{className:"relative w-16 h-16 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32",children:[(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5 rounded-full transform -translate-x-1/2 -translate-y-1/2 shadow-sm",style:{background:"radial-gradient(circle, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1))",backdropFilter:"blur(2px)",boxShadow:"0 0 8px rgba(255, 255, 255, 0.2), inset 0 0 4px rgba(255, 255, 255, 0.1)"}}),(0,a.jsx)("button",{type:"button",onClick:()=>{W.current&&j&&(W.current.position.y+=.2,W.current.floatData&&(W.current.floatData.baseY+=.2))},className:"absolute top-0 left-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-blue-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"上に移動",children:(0,a.jsx)(u.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{W.current&&j&&(W.current.position.y-=.2,W.current.floatData&&(W.current.floatData.baseY-=.2))},className:"absolute bottom-0 left-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-red-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"下に移動",children:(0,a.jsx)(m.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{W.current&&j&&(W.current.position.x-=.3)},className:"absolute left-0 top-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-green-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"左に移動",children:(0,a.jsx)(h.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{W.current&&j&&(W.current.position.x+=.3)},className:"absolute right-0 top-1/2 w-5 h-5 sm:w-7 sm:h-7 md:w-8 md:h-8 lg:w-9 lg:h-9 backdrop-blur-sm bg-purple-500 bg-opacity-40 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-60 transition-all duration-200 border border-gray-400 border-opacity-30 shadow-lg",title:"右に移動",children:(0,a.jsx)(b.A,{className:"w-2.5 h-2.5 sm:w-3.5 sm:h-3.5 md:w-4 md:h-4 lg:w-5 lg:h-5 text-white drop-shadow-sm"})})]})}),(0,a.jsx)("div",{className:"w-20 h-7 sm:w-28 sm:h-9 md:w-32 md:h-10 lg:w-36 lg:h-11 backdrop-blur-lg bg-gray-800 bg-opacity-15 rounded-full flex items-center justify-center border border-gray-400 border-opacity-30 px-3 sm:px-4 shadow-inner",children:(0,a.jsx)("input",{type:"range",min:.5,max:10,step:.2,value:I,onChange:e=>{let t=parseFloat(e.target.value);G(t),W.current&&W.current.scale.setScalar(t)},className:"w-full h-1 sm:h-1.5 md:h-2 rounded appearance-none cursor-pointer slider-thumb",title:"サイズ調整",style:{background:"linear-gradient(to right, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05))",backdropFilter:"blur(4px)"}})})]})]}),(0,a.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"10%"},children:(0,a.jsx)("button",{type:"button",onClick:()=>{if(!r.current)return;v(!0),setTimeout(()=>v(!1),150);let e=r.current.domElement.toDataURL("image/png"),t=document.createElement("a");t.download="ar-photo-".concat(Date.now(),".png"),t.href=e,t.click()},className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-36 xl:h-36 backdrop-blur-xl rounded-full flex items-center justify-center border-2 border-white border-opacity-20 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(34, 197, 94, 0.8))",boxShadow:"0 8px 32px rgba(59, 130, 246, 0.6), inset 0 2px 0 rgba(255, 255, 255, 0.1)"},children:(0,a.jsx)(i.A,{className:"w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 xl:w-18 xl:h-18 text-white drop-shadow-lg"})})}),y&&(0,a.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,a.jsxs)("div",{onClick:()=>{x(!0)},className:"relative flex items-center justify-center h-full cursor-pointer overflow-hidden",style:{background:"linear-gradient(135deg, #0891b2 0%, #065f46 25%, #0d9488 50%, #0891b2 75%, #065f46 100%)",backgroundSize:"400% 400%",animation:"waveGradient 15s ease infinite"},children:[(0,a.jsxs)("div",{className:"absolute inset-0",children:[(0,a.jsx)("div",{className:"absolute w-[200%] h-[200%] -top-1/2 -left-1/2 opacity-30",style:{background:"radial-gradient(circle at 30% 50%, rgba(34, 211, 238, 0.4) 0%, transparent 50%)",animation:"rotate 20s linear infinite"}}),(0,a.jsx)("div",{className:"absolute w-[200%] h-[200%] -bottom-1/2 -right-1/2 opacity-30",style:{background:"radial-gradient(circle at 70% 50%, rgba(16, 185, 129, 0.4) 0%, transparent 50%)",animation:"rotate 25s linear infinite reverse"}})]}),(0,a.jsxs)("div",{className:"text-center relative z-10",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(i.A,{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 text-white drop-shadow-2xl animate-bounce mx-auto"})}),(0,a.jsx)("p",{className:"text-white text-lg sm:text-xl font-light drop-shadow-lg",children:"タップしてカメラを起動"})]})]})})}}}]);