"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[138],{4355:(e,t,r)=>{r.d(t,{A:()=>o});let o=(0,r(7565).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},5138:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var o=r(5155),n=r(2115),i=r(5169);let a=(0,r(7565).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var s=r(4355);let l=()=>{let e=(0,n.useRef)(null),[t,r]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null),[h,u]=(0,n.useState)("coicoi"),g=(0,n.useRef)(null),w=(0,n.useRef)(null),x=(0,n.useRef)(null),p=(0,n.useRef)(null),f=(0,n.useRef)([]),b={coicoi:{mindFile:"/targets.mind",modelFile:"/coicoi.glb",modelName:"coicoi画像"},wkwk:{mindFile:"/targets.mind",modelFile:"/wkwk.glb",modelName:"wkwk画像"}};(0,n.useEffect)(()=>{(async()=>{try{if(!window.THREE||!window.MINDAR){for(let e of(console.log("Loading Three.js and MindAR libraries..."),["https://cdn.jsdelivr.net/npm/three@0.147.0/build/three.min.js","https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/loaders/GLTFLoader.js","https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"]))await new Promise((t,r)=>{let o=document.createElement("script");o.src=e,o.async=!1,o.onload=()=>{console.log("Loaded: ".concat(e)),t()},o.onerror=()=>{console.error("Failed to load: ".concat(e)),r(Error("Failed to load ".concat(e)))},document.head.appendChild(o)});await new Promise(e=>setTimeout(e,500)),console.log("All libraries loaded")}r(!0)}catch(e){console.error("Failed to load libraries:",e),m("ARライブラリの読み込みに失敗しました。")}})()},[]);let j=async()=>{if(!e.current)return void m("コンテナが見つかりません");try{console.log("Starting Three.js AR initialization...");let t=b[h];console.log("Using marker config:",t);let r=new window.MINDAR.IMAGE.MindARThree({container:e.current,imageTargetSrc:t.mindFile,filterMinCF:1e-4,filterBeta:1e3,missTolerance:5,warmupTolerance:5});g.current=r;let{renderer:o,scene:n,camera:i}=r;w.current=o,x.current=n,p.current=i,console.log("MindAR Three.js initialized");let a=new window.THREE.AmbientLight(0xffffff,.6);n.add(a);let s=new window.THREE.DirectionalLight(0xffffff,.8);s.position.set(0,1,1),n.add(s);let l=new window.THREE.GLTFLoader,d=r.addAnchor(0),m=new window.THREE.BoxGeometry(.5,.5,.5),u=new window.THREE.MeshBasicMaterial({color:0xff0000}),j=new window.THREE.Mesh(m,u);j.position.set(0,.5,0),d.group.add(j),l.load("/coicoi.glb",e=>{console.log("Coicoi model loaded");let t=e.scene;if(t.scale.set(1,1,1),t.position.set(0,0,0),d.group.add(t),e.animations&&e.animations.length>0){let r=new window.THREE.AnimationMixer(t);e.animations.forEach(e=>{r.clipAction(e).play()}),f.current.push(r)}},void 0,e=>{console.error("Error loading coicoi model:",e)});let k=r.addAnchor(1),y=new window.THREE.BoxGeometry(.5,.5,.5),N=new window.THREE.MeshBasicMaterial({color:0xffff00}),E=new window.THREE.Mesh(y,N);E.position.set(0,.5,0),k.group.add(E),l.load("/wkwk.glb",e=>{console.log("WKWK model loaded");let t=e.scene;if(t.scale.set(1,1,1),t.position.set(0,0,0),k.group.add(t),e.animations&&e.animations.length>0){let r=new window.THREE.AnimationMixer(t);e.animations.forEach(e=>{r.clipAction(e).play()}),f.current.push(r)}},void 0,e=>{console.error("Error loading wkwk model:",e)}),d.onTargetFound=()=>{console.log("\uD83C\uDFAF Coicoi target found!")},d.onTargetLost=()=>{console.log("❌ Coicoi target lost!")},k.onTargetFound=()=>{console.log("\uD83C\uDFAF WKWK target found!")},k.onTargetLost=()=>{console.log("❌ WKWK target lost!")},await r.start(),console.log("✅ MindAR Three.js started successfully");let v=new window.THREE.Clock,A=()=>{requestAnimationFrame(A);let e=v.getDelta();f.current.forEach(t=>{t.update(e)}),o.render(n,i)};A(),c(!0)}catch(e){console.error("AR initialization failed:",e),m("AR初期化に失敗しました: "+e.message)}},k=async()=>{try{g.current&&(await g.current.stop(),g.current=null),f.current=[],e.current&&(e.current.innerHTML=""),c(!1),console.log("AR stopped")}catch(e){console.error("Error stopping AR:",e)}},y=async()=>{await k(),setTimeout(()=>j(),500)};return(0,o.jsxs)("div",{className:"fixed inset-0 bg-black overflow-hidden",children:[(0,o.jsx)("div",{ref:e,className:"fixed inset-0",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",margin:0,padding:0}}),(0,o.jsx)("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/50 to-transparent z-10",children:(0,o.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,o.jsxs)("button",{onClick:()=>{k(),window.location.href="/start"},className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,o.jsx)(i.A,{className:"w-5 h-5"}),"戻る"]}),(0,o.jsx)("h1",{className:"text-lg font-semibold",children:"Three.js画像認識AR"}),(0,o.jsxs)("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg backdrop-blur-sm hover:bg-black/70 transition-colors",children:[(0,o.jsx)(a,{className:"w-5 h-5"}),"リセット"]})]})}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent z-10",children:(0,o.jsxs)("div",{className:"text-white text-center space-y-2",children:[(0,o.jsx)("p",{className:"text-sm opacity-90",children:"認識させたい画像をカメラに向けてください"}),(0,o.jsx)("div",{className:"flex justify-center space-x-4 text-xs",children:(0,o.jsx)("span",{className:"bg-black/50 px-3 py-1 rounded",children:"Three.js版で動作中"})})]})}),t&&!l&&!d&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-20",children:(0,o.jsxs)("div",{className:"text-white text-center",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Three.js AR開始"}),(0,o.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,o.jsx)("button",{onClick:()=>u("coicoi"),className:"px-6 py-3 rounded-lg transition-colors ".concat("coicoi"===h?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"coicoi画像"}),(0,o.jsx)("button",{onClick:()=>u("wkwk"),className:"px-6 py-3 rounded-lg transition-colors ".concat("wkwk"===h?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"wkwk画像"})]}),(0,o.jsxs)("button",{onClick:j,className:"flex items-center gap-3 px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-lg font-semibold transition-colors mx-auto",children:[(0,o.jsx)(s.A,{className:"w-6 h-6"}),"Three.js ARを開始"]})]})}),!t&&!d&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,o.jsxs)("div",{className:"text-white text-center",children:[(0,o.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-cyan-600 border-t-transparent rounded-full mx-auto mb-4"}),(0,o.jsx)("p",{children:"Three.js & MindARライブラリを読み込み中..."})]})}),d&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black z-20",children:(0,o.jsxs)("div",{className:"text-white text-center max-w-md mx-4",children:[(0,o.jsx)("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),(0,o.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"エラーが発生しました"}),(0,o.jsx)("p",{className:"text-gray-300 mb-4",children:d}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors",children:"再試行"})]})})]})}},5169:(e,t,r)=>{r.d(t,{A:()=>o});let o=(0,r(7565).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7565:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(2115);let n=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,o.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:l,className:c="",children:d,iconNode:m,...h}=e;return(0,o.createElement)("svg",{ref:t,...a,width:n,height:n,stroke:r,strokeWidth:l?24*Number(s)/Number(n):s,className:i("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...m.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),l=(e,t)=>{let r=(0,o.forwardRef)((r,a)=>{let{className:l,...c}=r;return(0,o.createElement)(s,{ref:a,iconNode:t,className:i("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...c})});return r.displayName=n(e),r}}}]);