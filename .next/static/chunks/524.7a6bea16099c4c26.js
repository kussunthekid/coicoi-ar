"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{1524:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var n=r(5155),a=r(2115),l=r(3264),o=r(7431),i=r(4559),s=r(5198),c=r(4355),u=r(9881),d=r(8832),m=r(5169),f=r(2138),h=r(9477);let b=()=>{let e=(0,a.useRef)(null),t=(0,a.useRef)(null),r=(0,a.useRef)(null),b=(0,a.useRef)(null),p=(0,a.useRef)(null),x=(0,a.useRef)(null),[g,w]=(0,a.useState)(!1),[y,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[k,E]=(0,a.useState)(-100*Math.PI/180),[R,C]=(0,a.useState)(2.4),M=(0,a.useRef)(null),D=(0,a.useRef)(null),S=(0,a.useRef)(new l.tBo),A=(0,a.useRef)(new l.I9Y),L=(0,h.useGesture)({onDrag:e=>{let{xy:[t,n],first:a,active:l}=e;M.current&&l&&j&&(a&&console.log("Drag started"),((e,t)=>{if(!M.current||!b.current||!r.current)return;let n=r.current.domElement.getBoundingClientRect();A.current.x=(e-n.left)/n.width*2-1,A.current.y=-(2*((t-n.top)/n.height))+1,S.current.setFromCamera(A.current,b.current);let a=S.current.ray.direction,l=S.current.ray.origin,o=(0-l.y)/a.y;if(o>0){let e=l.clone().add(a.clone().multiplyScalar(o));M.current.position.x=e.x,M.current.position.z=e.z,M.current.floatData&&(M.current.floatData.baseY=.1)}})(t,n))},onPinch:e=>{let{da:[t,r],first:n,memo:a}=e;if(!M.current||!j)return;if(n)return console.log("2-finger rotation started"),{initialRotation:k,initialAngle:r};let l=(r-((null==a?void 0:a.initialAngle)||0))*Math.PI/180,o=((null==a?void 0:a.initialRotation)||k)+l;return E(o),M.current.rotation.y=o,console.log("Rotation:",Math.round(180*o/Math.PI),"\xb0"),a},onWheel:e=>{let{delta:[t,r],shiftKey:n}=e;if(M.current&&j)if(n){let e=k+.01*r;E(e),M.current.rotation.y=e,console.log("Shift+Scroll Rotation:",Math.round(180*e/Math.PI),"\xb0")}else{let e=Math.max(.5,Math.min(10,R*(1-.001*r)));C(e),M.current.scale.setScalar(e)}}},{pinch:{scaleBounds:{min:.1,max:5},rubberband:!0}});return(0,a.useEffect)(()=>{if(!g)return;let n=window.innerWidth,a=window.innerHeight,c=new l.Z58;t.current=c;let u=new i.i7;b.current=u;let d=new o.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});d.setSize(n,a),d.setPixelRatio(window.devicePixelRatio),r.current=d,e.current&&e.current.appendChild(d.domElement),i.hb(d.getContext());let m=new i.ru,f=new i._z;x.current=f,f.setCamera(u);let h=new l.YJl;D.current=h,h.position.setFromMatrixPosition(f.anchor.matrixWorld),c.add(h);let w=new l.$p8(0xffffff,1.2);c.add(w);let y=new l.ZyN(0xffffff,1.5);y.position.set(5,10,5),c.add(y);let v=new l.ZyN(0xffffff,.8);v.position.set(-5,5,-5),c.add(v);let k=new l.HiM(0xffffff,1,100);k.position.set(0,3,0),h.add(k),m.start();let E=e=>{j||j||new s.B().load("/coicoi.glb",e=>{let t=e.scene.clone();t.scale.setScalar(2.4),t.position.set(0,.1,0),t.rotation.y=-100*Math.PI/180,t.floatData={baseY:.1,amplitude:.3,speed:.02,time:0},t.isCoicoiModel=!0,M.current=t,h.add(t),N(!0),f.enabled=!0},e=>{console.log("Loading progress:",e.loaded/e.total*100+"%")},e=>{console.error("Error loading GLB model:",e)})};d.domElement.addEventListener("click",E),d.domElement.addEventListener("touchend",E);let R=()=>{if(p.current=requestAnimationFrame(R),u.updateFrame(d),f.enabled&&D.current&&(D.current.position.setFromMatrixPosition(f.anchor.matrixWorld),D.current.rotation.setFromRotationMatrix(f.anchor.matrixWorld)),M.current&&M.current.floatData){let e=M.current.floatData;e.time+=e.speed,M.current.position.y=e.baseY+Math.sin(e.time)*e.amplitude}d.render(c,u)};R();let C=()=>{let e=window.innerWidth,t=window.innerHeight;d.setSize(e,t)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),d.domElement.removeEventListener("click",E),d.domElement.removeEventListener("touchend",E),p.current&&cancelAnimationFrame(p.current),e.current&&d.domElement&&e.current.removeChild(d.domElement),d.dispose(),m.destroy()}},[g]),(0,n.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black touch-none",children:g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{ref:e,...L(),className:"absolute top-0 left-0 w-full h-full touch-none",style:{touchAction:"none"}}),!j&&(0,n.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,n.jsx)("div",{className:"text-sm text-center",children:"画面をタップして配置"})}),j&&(0,n.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2",children:[(0,n.jsx)("div",{className:"w-20 h-20 bg-black bg-opacity-80 rounded-full flex items-center justify-center backdrop-blur-sm border border-gray-500",children:(0,n.jsxs)("div",{className:"relative w-16 h-16",children:[(0,n.jsx)("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full transform -translate-x-1/2 -translate-y-1/2 opacity-50"}),(0,n.jsx)("button",{type:"button",onClick:()=>{M.current&&j&&(M.current.position.y+=.2,M.current.floatData&&(M.current.floatData.baseY+=.2))},className:"absolute top-0 left-1/2 w-6 h-6 bg-blue-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-100 transition-all",title:"上に移動",children:(0,n.jsx)(u.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{M.current&&j&&(M.current.position.y-=.2,M.current.floatData&&(M.current.floatData.baseY-=.2))},className:"absolute bottom-0 left-1/2 w-6 h-6 bg-red-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-100 transition-all",title:"下に移動",children:(0,n.jsx)(d.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{M.current&&j&&(M.current.position.x-=.3)},className:"absolute left-0 top-1/2 w-6 h-6 bg-green-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-100 transition-all",title:"左に移動",children:(0,n.jsx)(m.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{M.current&&j&&(M.current.position.x+=.3)},className:"absolute right-0 top-1/2 w-6 h-6 bg-purple-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-100 transition-all",title:"右に移動",children:(0,n.jsx)(f.A,{className:"w-3 h-3 text-white"})})]})}),(0,n.jsx)("div",{className:"w-20 h-8 bg-black bg-opacity-80 rounded-full flex items-center justify-center backdrop-blur-sm border border-gray-500 px-2",children:(0,n.jsx)("input",{type:"range",min:.5,max:10,step:.2,value:R,onChange:e=>{let t=parseFloat(e.target.value);C(t),M.current&&M.current.scale.setScalar(t)},className:"w-full h-1 bg-gray-600 rounded appearance-none cursor-pointer",title:"サイズ調整"})})]}),(0,n.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"15%"},children:(0,n.jsx)("button",{type:"button",onClick:()=>{if(!r.current)return;v(!0),setTimeout(()=>v(!1),150);let e=r.current.domElement.toDataURL("image/png"),t=document.createElement("a");t.download="ar-photo-".concat(Date.now(),".png"),t.href=e,t.click()},className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-28 lg:h-28 bg-gray-600 bg-opacity-70 backdrop-blur-md rounded-full flex items-center justify-center border-2 border-gray-400 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",children:(0,n.jsx)(c.A,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-14 lg:h-14 text-white drop-shadow-lg"})})}),y&&(0,n.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,n.jsx)("div",{onClick:()=>{w(!0)},className:"flex items-center justify-center h-full cursor-pointer bg-gradient-to-br from-gray-900 to-black",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 bg-gray-600 bg-opacity-30 rounded-full flex items-center justify-center backdrop-blur-sm transition-transform hover:scale-110",children:(0,n.jsx)(c.A,{className:"w-16 h-16 text-white"})}),(0,n.jsx)("p",{className:"text-white text-lg font-light",children:"タップして開始"})]})})})}}}]);