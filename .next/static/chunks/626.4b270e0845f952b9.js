"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{3626:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(5155),a=r(2115),l=r(3264),s=r(7431),o=r(5198),i=r(4355),c=r(9881),u=r(8832),d=r(5169),m=r(2138),f=r(9477);let h=()=>{let e=(0,a.useRef)(null),t=(0,a.useRef)(null),h=(0,a.useRef)(null),b=(0,a.useRef)(null),p=(0,a.useRef)(null),x=(0,a.useRef)(null),[g,w]=(0,a.useState)(!1),[y,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[k,R]=(0,a.useState)(!1),[C,E]=(0,a.useState)(-100*Math.PI/180),[S,D]=(0,a.useState)(2.4),A=(0,a.useRef)(null),M=(0,a.useRef)(null),P=(0,a.useRef)(new l.tBo),I=(0,a.useRef)(new l.I9Y),z=(0,f.useGesture)({onDrag:e=>{let{xy:[t,r],first:n,active:a}=e;A.current&&a&&j&&(n&&console.log("Drag started"),((e,t)=>{if(!A.current||!b.current||!h.current)return;let r=h.current.domElement.getBoundingClientRect();I.current.x=(e-r.left)/r.width*2-1,I.current.y=-(2*((t-r.top)/r.height))+1,P.current.setFromCamera(I.current,b.current);let n=P.current.ray.direction,a=P.current.ray.origin,l=(0-a.y)/n.y;if(l>0){let e=a.clone().add(n.clone().multiplyScalar(l));A.current.position.x=e.x,A.current.position.z=e.z,A.current.floatData&&(A.current.floatData.baseY=.1)}})(t,r))},onPinch:e=>{let{da:[,t],first:r,memo:n}=e;if(!A.current||!j)return;if(r)return console.log("2-finger rotation started"),{initialRotation:C,initialAngle:t};let a=(t-((null==n?void 0:n.initialAngle)||0))*Math.PI/180,l=((null==n?void 0:n.initialRotation)||C)+a;return E(l),A.current.rotation.y=l,console.log("Rotation:",Math.round(180*l/Math.PI),"\xb0"),n},onWheel:e=>{let{delta:[,t],shiftKey:r}=e;if(A.current&&j)if(r){let e=C+.01*t;E(e),A.current.rotation.y=e,console.log("Shift+Scroll Rotation:",Math.round(180*e/Math.PI),"\xb0")}else{let e=Math.max(.5,Math.min(10,S*(1-.001*t)));D(e),A.current.scale.setScalar(e)}}},{pinch:{scaleBounds:{min:.1,max:5},rubberband:!0}});return(0,a.useEffect)(()=>{g&&(async()=>{try{let n=await Promise.all([r.e(285),r.e(280)]).then(r.bind(r,6280));console.log("Zappar loaded successfully");let a=window.innerWidth,i=window.innerHeight,c=new l.Z58;t.current=c;let u=new n.Camera;b.current=u;let d=new s.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});d.setSize(a,i),d.setPixelRatio(window.devicePixelRatio),h.current=d,e.current&&e.current.appendChild(d.domElement),n.glContextSet(d.getContext());let m=new n.CameraSource,f=new n.InstantWorldTracker;x.current=f;let g=new n.InstantWorldAnchorGroup(u,f);M.current=g,c.add(g);let w=new l.$p8(0xffffff,1.2);c.add(w);let y=new l.ZyN(0xffffff,1.5);y.position.set(5,10,5),c.add(y),m.start(),R(!0);let v=()=>{j||j||new o.B().load("/coicoi.glb",e=>{let t=e.scene.clone();t.scale.setScalar(2.4),t.position.set(0,.1,0),t.rotation.y=-100*Math.PI/180,t.floatData={baseY:.1,amplitude:.3,speed:.02,time:0},A.current=t,g.add(t),N(!0)},void 0,e=>{console.error("Error loading GLB model:",e)})};d.domElement.addEventListener("click",v);let k=()=>{if(p.current=requestAnimationFrame(k),u.updateFrame(d),A.current&&A.current.floatData){let e=A.current.floatData;e.time+=e.speed,A.current.position.y=e.baseY+Math.sin(e.time)*e.amplitude}d.render(c,u)};k();let C=()=>{let e=window.innerWidth,t=window.innerHeight;d.setSize(e,t)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),d.domElement.removeEventListener("click",v),p.current&&cancelAnimationFrame(p.current),e.current&&d.domElement&&e.current.removeChild(d.domElement),d.dispose(),m.destroy()}}catch(e){console.error("Failed to initialize Zappar:",e),R(!1)}})()},[g]),(0,n.jsx)("div",{className:"relative w-full h-screen overflow-hidden bg-black touch-none",children:g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{ref:e,...z(),className:"absolute top-0 left-0 w-full h-full touch-none",style:{touchAction:"none"}}),!k&&(0,n.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,n.jsx)("div",{className:"text-sm text-center",children:"Zappar ARを初期化中..."})}),k&&!j&&(0,n.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg",children:(0,n.jsx)("div",{className:"text-sm text-center",children:"画面をタップして配置"})}),j&&(0,n.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2",children:[(0,n.jsx)("div",{className:"w-20 h-20 bg-black bg-opacity-80 rounded-full flex items-center justify-center backdrop-blur-sm border border-gray-500",children:(0,n.jsxs)("div",{className:"relative w-16 h-16",children:[(0,n.jsx)("div",{className:"absolute top-1/2 left-1/2 w-3 h-3 bg-white rounded-full transform -translate-x-1/2 -translate-y-1/2 opacity-50"}),(0,n.jsx)("button",{type:"button",onClick:()=>{A.current&&j&&(A.current.position.y+=.2,A.current.floatData&&(A.current.floatData.baseY+=.2))},className:"absolute top-0 left-1/2 w-6 h-6 bg-blue-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-100 transition-all",title:"上に移動",children:(0,n.jsx)(c.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{A.current&&j&&(A.current.position.y-=.2,A.current.floatData&&(A.current.floatData.baseY-=.2))},className:"absolute bottom-0 left-1/2 w-6 h-6 bg-red-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-x-1/2 hover:bg-opacity-100 transition-all",title:"下に移動",children:(0,n.jsx)(u.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{A.current&&j&&(A.current.position.x-=.3)},className:"absolute left-0 top-1/2 w-6 h-6 bg-green-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-100 transition-all",title:"左に移動",children:(0,n.jsx)(d.A,{className:"w-3 h-3 text-white"})}),(0,n.jsx)("button",{type:"button",onClick:()=>{A.current&&j&&(A.current.position.x+=.3)},className:"absolute right-0 top-1/2 w-6 h-6 bg-purple-500 bg-opacity-80 rounded-full flex items-center justify-center transform -translate-y-1/2 hover:bg-opacity-100 transition-all",title:"右に移動",children:(0,n.jsx)(m.A,{className:"w-3 h-3 text-white"})})]})}),(0,n.jsx)("div",{className:"w-20 h-8 bg-black bg-opacity-80 rounded-full flex items-center justify-center backdrop-blur-sm border border-gray-500 px-2",children:(0,n.jsx)("input",{type:"range",min:.5,max:10,step:.2,value:S,onChange:e=>{let t=parseFloat(e.target.value);D(t),A.current&&A.current.scale.setScalar(t)},className:"w-full h-1 bg-gray-600 rounded appearance-none cursor-pointer",title:"サイズ調整"})})]}),(0,n.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",style:{bottom:"15%"},children:(0,n.jsx)("button",{type:"button",onClick:()=>{if(!h.current)return;v(!0),setTimeout(()=>v(!1),150);let e=h.current.domElement.toDataURL("image/png"),t=document.createElement("a");t.download="ar-photo-".concat(Date.now(),".png"),t.href=e,t.click()},className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 lg:w-28 lg:h-28 bg-gray-600 bg-opacity-70 backdrop-blur-md rounded-full flex items-center justify-center border-2 border-gray-400 shadow-xl transition-all hover:scale-110 active:scale-95",title:"写真を撮影",children:(0,n.jsx)(i.A,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-14 lg:h-14 text-white drop-shadow-lg"})})}),y&&(0,n.jsx)("div",{className:"absolute inset-0 bg-white pointer-events-none animate-pulse"})]}):(0,n.jsx)("div",{onClick:()=>{w(!0)},className:"flex items-center justify-center h-full cursor-pointer bg-gradient-to-br from-gray-900 to-black",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 bg-gray-600 bg-opacity-30 rounded-full flex items-center justify-center backdrop-blur-sm transition-transform hover:scale-110",children:(0,n.jsx)(i.A,{className:"w-16 h-16 text-white"})}),(0,n.jsx)("p",{className:"text-white text-lg font-light",children:"タップして開始"})]})})})}}}]);